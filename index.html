<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MehmetEndüstriyelTakip - Orta Gerilim Hücre Üretim Takip Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
    <script>
        // Service Worker Kaydı
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker başarıyla kaydedildi:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker kaydı başarısız:', error);
                    });
            });
        }
    </script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
        }
        
        .sidebar {
            background-color: var(--primary-color);
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
            width: 250px; /* Sabit genişlik eklendi */
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
            border-radius: 5px;
            padding: 10px 15px;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-planned {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .status-in-progress {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        
        .status-delayed {
            background-color: #ffebee;
            color: #d32f2f;
        }
        
        .status-completed {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        
        .priority-high {
            border-left: 4px solid var(--danger-color);
        }
        
        .priority-medium {
            border-left: 4px solid var(--warning-color);
        }
        
        .priority-low {
            border-left: 4px solid var(--success-color);
        }
        
        .ai-chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .ai-chatbot-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ai-chatbot-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .progress-thin {
            height: 5px;
        }
        
        .custom-table th {
            background-color: var(--light-color);
            font-weight: 600;
        }
        
        .material-required {
            background-color: #fff3e0;
        }
        
        .material-available {
            background-color: #e8f5e9;
        }
        
        .material-critical {
            background-color: #ffebee;
        }
        
        /* Gantt chart styles */
        .gantt-container {
            font-size: 12px;
        }
        
        .gantt-header {
            font-weight: bold;
        }
        
        .gantt-day {
            border: 1px solid #dee2e6;
            padding: 2px;
        }
        
        .gantt-row {
            height: 30px;
            display: flex;
            align-items: center;
        }
        
        .gantt-bar {
            height: 20px;
            border-radius: 3px;
            position: absolute;
            top: 5px;
        }
        
        /* Chat modal styles */
        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .user-message {
            background-color: #e3f2fd;
            margin-left: auto;
        }
        
        .ai-message {
            background-color: #f1f1f1;
            margin-right: auto;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .sidebar {
                width: 220px;
            }
            .main-content {
                margin-left: 220px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
        }

        /* Not ve Uyarı Sistemi için Stil Tanımlamaları */
        .notification-pill {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            position: absolute;
            top: 2px;
            right: 2px;
        }
        
        .notification-yellow {
            background-color: #ffeb3b;
            color: #333;
        }
        
        .notification-red {
            background-color: #f44336;
            color: white;
        }
        
        .notification-counter {
            display: inline-block;
            margin-left: 4px;
            background-color: rgba(0,0,0,0.1);
            padding: 0 4px;
            border-radius: 8px;
            font-size: 9px;
        }
        
        .order-card {
            position: relative;
        }
        
        .alert-note {
            border-left: 4px solid;
            margin-bottom: 10px;
            padding: 10px;
            position: relative;
        }
        
        .alert-note-yellow {
            border-left-color: #ffeb3b;
            background-color: #fffde7;
        }
        
        .alert-note-red {
            border-left-color: #f44336;
            background-color: #ffebee;
        }
        
        .alert-note-success {
            border-left-color: #4caf50;
            background-color: #e8f5e9;
        }
        
        .alert-note .meta {
            font-size: 0.8em;
            color: #666;
            margin-top: 8px;
        }
        
        .alert-note .actions {
            position: absolute;
            right: 10px;
            top: 10px;
        }
        
        .notification-badge.has-alerts {
            animation: pulse 1.5s infinite;
        }
        
        .department-badge {
            font-size: 0.75em;
            font-weight: normal;
            vertical-align: middle;
            margin-left: 5px;
        }
        
        .timer-countdown {
            font-size: 0.8em;
            color: #d32f2f;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar col-md-3 col-lg-2 d-md-block">
        <div class="text-center mb-4">
            <h4>MehmetEndüstriyelTakip</h4>
            <p class="text-muted small">Orta Gerilim Hücre Üretim Takip</p>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                    <i class="bi bi-speedometer2"></i> Genel Bakış
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#orders" data-bs-toggle="tab">
                    <i class="bi bi-file-earmark-text"></i> Siparişler
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#production" data-bs-toggle="tab">
                    <i class="bi bi-gear"></i> Üretim Takip
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#materials" data-bs-toggle="tab">
                    <i class="bi bi-box-seam"></i> Malzeme Yönetimi
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#planning" data-bs-toggle="tab">
                    <i class="bi bi-calendar-check"></i> Planlama
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#reports" data-bs-toggle="tab">
                    <i class="bi bi-graph-up"></i> Raporlar & Analizler
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#technical" data-bs-toggle="tab">
                    <i class="bi bi-file-earmark-code"></i> Teknik Dokümanlar
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#settings" data-bs-toggle="tab">
                    <i class="bi bi-sliders"></i> Ayarlar
                </a>
            </li>
        </ul>
        <div class="mt-auto p-3 text-center text-muted small">
            <p>v1.0.0</p>
            <p>© 2023 MehmetEndüstriyel</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Orta Gerilim Hücre Üretim Takip Sistemi</h2>
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person-circle"></i> Yönetici
                </button>
                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profil</a></li>
                    <li><a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Ayarlar</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right"></i> Çıkış Yap</a></li>
                </ul>
            </div>
        </div>

        <div class="tab-content">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Aktif Siparişler</h6>
                                        <h3 class="mb-0">24</h3>
                                    </div>
                                    <div class="bg-primary bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-file-earmark-text text-primary" style="font-size: 1.5rem;"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success"><i class="bi bi-arrow-up"></i> 5.2%</span>
                                    <span class="text-muted">geçen aya göre</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Devam Eden Üretim</h6>
                                        <h3 class="mb-0">18</h3>
                                    </div>
                                    <div class="bg-warning bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-gear text-warning" style="font-size: 1.5rem;"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-danger"><i class="bi bi-arrow-down"></i> 2.1%</span>
                                    <span class="text-muted">geçen aya göre</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Geciken Siparişler</h6>
                                        <h3 class="mb-0">3</h3>
                                    </div>
                                    <div class="bg-danger bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-exclamation-triangle text-danger" style="font-size: 1.5rem;"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success"><i class="bi bi-arrow-down"></i> 1.8%</span>
                                    <span class="text-muted">geçen aya göre</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="text-muted mb-2">Tamamlanan Siparişler</h6>
                                        <h3 class="mb-0">42</h3>
                                    </div>
                                    <div class="bg-success bg-opacity-10 p-3 rounded">
                                        <i class="bi bi-check-circle text-success" style="font-size: 1.5rem;"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success"><i class="bi bi-arrow-up"></i> 8.7%</span>
                                    <span class="text-muted">geçen aya göre</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Üretim Durumu</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="productionStatusDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        Son 30 Gün
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="productionStatusDropdown">
                                        <li><a class="dropdown-item" href="#">Son 7 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Son 30 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Son 90 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Bu Yıl</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="productionChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Hücre Tipi Dağılımı</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="cellTypeChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Kritik Malzeme Durumu</h5>
                                <a href="#" class="btn btn-sm btn-outline-primary">Tümünü Gör</a>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Malzeme Kodu</th>
                                                <th>Malzeme Adı</th>
                                                <th>Stok</th>
                                                <th>İhtiyaç</th>
                                                <th>Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="material-critical">
                                                <td>137998%</td>
                                                <td>Siemens 7SR1003-1JA20-2DA0+ZY20 24VDC</td>
                                                <td>2</td>
                                                <td>8</td>
                                                <td><span class="badge bg-danger">Kritik</span></td>
                                            </tr>
                                            <tr class="material-required">
                                                <td>144866%</td>
                                                <td>KAP-80/190-95 Akım Trafosu</td>
                                                <td>3</td>
                                                <td>5</td>
                                                <td><span class="badge bg-warning">Eksik</span></td>
                                            </tr>
                                            <tr class="material-required">
                                                <td>120170%</td>
                                                <td>M480TB/G-027-95.300UN5 Kablo Başlığı</td>
                                                <td>12</td>
                                                <td>15</td>
                                                <td><span class="badge bg-warning">Eksik</span></td>
                                            </tr>
                                            <tr class="material-available">
                                                <td>109367%</td>
                                                <td>582mm Bara</td>
                                                <td>25</td>
                                                <td>18</td>
                                                <td><span class="badge bg-success">Yeterli</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Son Uyarılar</h5>
                                <div>
                                    <button class="btn btn-sm btn-outline-danger me-2" onclick="showPendingAlerts()">
                                        <i class="bi bi-exclamation-triangle"></i> Yanıt Bekleyenler
                                        <span class="badge bg-danger" id="pendingAlertsCount">3</span>
                                    </button>
                                    <a href="#" class="btn btn-sm btn-outline-primary" onclick="openAllAlertsModal()">Tümünü Gör</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="list-group" id="dashboardAlerts">
                                    <a href="#" class="list-group-item list-group-item-action border-danger border-start-0 border-end-0 border-top-0 border-3" onclick="viewAlertDetail('ALT-001')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">
                                                <span class="notification-pill notification-red">Kritik</span>
                                                Teslim Tarihi Gecikmesi
                                                <span class="badge bg-secondary department-badge">Mekanik Üretim</span>
                                            </h6>
                                            <small class="text-danger">1 saat önce</small>
                                        </div>
                                        <p class="mb-1">Sipariş No: #0424-1251 - RM 36 CB hücresinin mekanik montajı gecikiyor.</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Yanıt bekleniyor - <span class="timer-countdown">1:45:22</span> kaldı</small>
                                            <button class="btn btn-sm btn-danger" onclick="respondToAlert('ALT-001', event)">Yanıtla</button>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action border-warning border-start-0 border-end-0 border-top-0 border-3" onclick="viewAlertDetail('ALT-002')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">
                                                <span class="notification-pill notification-yellow">Önemli</span>
                                                Malzeme Eksikliği
                                                <span class="badge bg-secondary department-badge">Satın Alma</span>
                                            </h6>
                                            <small class="text-warning">3 saat önce</small>
                                        </div>
                                        <p class="mb-1">Sipariş No: #0424-1245 için gerekli akım trafosu stokta yok.</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Yanıtlandı - 2 gün içinde tedarik edilecek</small>
                                            <button class="btn btn-sm btn-secondary" onclick="viewAlertResponses('ALT-002', event)">Yanıtlar</button>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action border-success border-start-0 border-end-0 border-top-0 border-3" onclick="viewAlertDetail('ALT-003')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">
                                                <span class="notification-pill notification-yellow">Önemli</span>
                                                Sorun Çözüldü
                                                <span class="badge bg-secondary department-badge">Kablaj</span>
                                            </h6>
                                            <small class="text-success">5 saat önce</small>
                                        </div>
                                        <p class="mb-1">Sipariş No: #0424-1239 için kablaj problemi çözüldü.</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Çözüldü - Kapandı</small>
                                            <button class="btn btn-sm btn-success" onclick="viewAlertResponses('ALT-003', event)">Detay</button>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Tab -->
            <div class="tab-pane fade" id="orders">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Sipariş Yönetimi</h5>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newOrderModal">
                            <i class="bi bi-plus"></i> Yeni Sipariş Ekle
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" placeholder="Sipariş No Ara...">
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select">
                                        <option selected>Hücre Tipi Seçin</option>
                                        <option>RM 36 CB</option>
                                        <option>RM 36 LB</option>
                                        <option>RM 36 FL</option>
                                        <option>RMU</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select">
                                        <option selected>Durum Seçin</option>
                                        <option>Planlandı</option>
                                        <option>Devam Ediyor</option>
                                        <option>Gecikmiş</option>
                                        <option>Tamamlandı</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-outline-secondary w-100">Filtrele</button>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover custom-table">
                                <thead>
                                    <tr>
                                        <th>Sipariş No</th>
                                        <th>Müşteri</th>
                                        <th>Hücre Tipi</th>
                                        <th>Miktar</th>
                                        <th>Planlanan Teslim</th>
                                        <th>Durum</th>
                                        <th>İlerleme</th>
                                        <th>İşlemler</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="priority-high">
                                        <td>#0424-1251</td>
                                        <td>AYEDAŞ</td>
                                        <td>RM 36 CB</td>
                                        <td>1</td>
                                        <td>15.11.2024</td>
                                        <td><span class="status-badge status-delayed">Gecikiyor</span></td>
                                        <td>
                                            <div class="progress progress-thin">
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 65%"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                        </td>
                                    </tr>
                                    <tr class="priority-medium">
                                        <td>#0424-1245</td>
                                        <td>TEİAŞ</td>
                                        <td>RM 36 CB</td>
                                        <td>1</td>
                                        <td>20.11.2024</td>
                                        <td><span class="status-badge status-in-progress">Devam Ediyor</span></td>
                                        <td>
                                            <div class="progress progress-thin">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 45%"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>#0424-1239</td>
                                        <td>BEDAŞ</td>
                                        <td>RM 36 LB</td>
                                        <td>1</td>
                                        <td>25.11.2024</td>
                                        <td><span class="status-badge status-in-progress">Devam Ediyor</span></td>
                                        <td>
                                            <div class="progress progress-thin">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 30%"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>#0424-1235</td>
                                        <td>OSMANİYE ELEKTRİK</td>
                                        <td>RM 36 FL</td>
                                        <td>1</td>
                                        <td>30.11.2024</td>
                                        <td><span class="status-badge status-planned">Planlandı</span></td>
                                        <td>
                                            <div class="progress progress-thin">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 10%"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>#0424-1233</td>
                                        <td>ENERJİSA</td>
                                        <td>RM 36 LB</td>
                                        <td>1</td>
                                        <td>05.12.2024</td>
                                        <td><span class="status-badge status-completed">Tamamlandı</span></td>
                                        <td>
                                            <div class="progress progress-thin">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                            <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Önceki</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Sonraki</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Production Tab -->
            <div class="tab-pane fade" id="production">
                <!-- Görev Yönetimi Kartı - YENİ -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Günlük Görev Yönetimi</h5>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary" id="refreshTasksBtn">
                                        <i class="bi bi-arrow-clockwise"></i> Yenile
                                    </button>
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                                        <i class="bi bi-plus"></i> Yeni Görev
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="taskStats" class="mb-4">
                                    <!-- İstatistikler buraya gelecek -->
                                </div>
                                <div class="table-responsive">
                                    <table id="taskTable" class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Görev No</th>
                                                <th>Sipariş No</th>
                                                <th>Aşama</th>
                                                <th>Sorumlu</th>
                                                <th>Planlanan Süre</th>
                                                <th>Durum</th>
                                                <th>İlerleme</th>
                                                <th>Gecikme Nedeni</th>
                                                <th>Ek Mesai</th>
                                                <th>İşlemler</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Görev listesi buraya gelecek -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mevcut üretim takibi ve diğer bölümler -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Üretim Takip Tablosu</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary">Günlük</button>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                            </tr>
                                            <tr>
                                                <td>#0424-1239</td>
                                                <td>RM 36 LB</td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                            </tr>
                                            <tr>
                                                <td>#0424-1235</td>
                                                <td>RM 36 FL</td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-success"><i class="bi bi-check"></i></span></td>
                                                <td><span class="badge bg-warning"><i class="bi bi-exclamation-triangle"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                                <td><span class="badge bg-secondary"><i class="bi bi-dash"></i></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Üretim Gantt Şeması</h5>
                            </div>
                            <div class="card-body">
                                <div style="height: 400px; overflow-y: auto;">
                                    <div class="gantt-container">
                                        <div class="gantt-header d-flex mb-2">
                                            <div style="width: 120px;"></div>
                                            <div class="d-flex flex-grow-1">
                                                <div class="gantt-day text-center" style="width: 30px;">Pzt</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Sal</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Çar</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Per</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Cum</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Cmt</div>
                                                <div class="gantt-day text-center" style="width: 30px;">Paz</div>
                                            </div>
                                        </div>
                                        <div class="gantt-row mb-2">
                                            <div style="width: 120px; font-size: 12px;">#0424-1251</div>
                                            <div class="d-flex flex-grow-1 position-relative">
                                                <div class="gantt-bar bg-danger" style="left: 90px; width: 120px;">Mekanik Üretim</div>
                                            </div>
                                        </div>
                                        <div class="gantt-row mb-2">
                                            <div style="width: 120px; font-size: 12px;">#0424-1245</div>
                                            <div class="d-flex flex-grow-1 position-relative">
                                                <div class="gantt-bar bg-warning" style="left: 60px; width: 60px;">Satın Alma</div>
                                            </div>
                                        </div>
                                        <div class="gantt-row mb-2">
                                            <div style="width: 120px; font-size: 12px;">#0424-1239</div>
                                            <div class="d-flex flex-grow-1 position-relative">
                                                <div class="gantt-bar bg-success" style="left: 30px; width: 30px;">Mekanik Tasarım</div>
                                            </div>
                                        </div>
                                        <div class="gantt-row mb-2">
                                            <div style="width: 120px; font-size: 12px;">#0424-1235</div>
                                            <div class="d-flex flex-grow-1 position-relative">
                                                <div class="gantt-bar bg-primary" style="left: 0px; width: 30px;">Elektrik Tasarım</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Birim Bazlı Üretim Takibi</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="unitDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        Tüm Birimler
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="unitDropdown">
                                        <li><a class="dropdown-item" href="#">Elektrik Tasarım</a></li>
                                        <li><a class="dropdown-item" href="#">Mekanik Tasarım</a></li>
                                        <li><a class="dropdown-item" href="#">Satın Alma</a></li>
                                        <li><a class="dropdown-item" href="#">Mekanik Üretim</a></li>
                                        <li><a class="dropdown-item" href="#">İç Montaj</a></li>
                                        <li><a class="dropdown-item" href="#">Kablaj</a></li>
                                        <li><a class="dropdown-item" href="#">Genel Montaj</a></li>
                                        <li><a class="dropdown-item" href="#">Test</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="card mb-3">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">Elektrik Tasarım</h6>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <div>
                                                        <h3 class="mb-0">4</h3>
                                                        <small class="text-muted">Toplam İş</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">2</h3>
                                                        <small class="text-muted">Devam Eden</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">2</h3>
                                                        <small class="text-muted">Tamamlanan</small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-3">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 50%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card mb-3">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">Mekanik Tasarım</h6>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <div>
                                                        <h3 class="mb-0">4</h3>
                                                        <small class="text-muted">Toplam İş</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">1</h3>
                                                        <small class="text-muted">Devam Eden</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">3</h3>
                                                        <small class="text-muted">Tamamlanan</small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-3">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 75%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card mb-3">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">Satın Alma</h6>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <div>
                                                        <h3 class="mb-0">4</h3>
                                                        <small class="text-muted">Toplam İş</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">1</h3>
                                                        <small class="text-muted">Devam Eden</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">3</h3>
                                                        <small class="text-muted">Tamamlanan</small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-3">
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 75%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card mb-3">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">Mekanik Üretim</h6>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <div>
                                                        <h3 class="mb-0">4</h3>
                                                        <small class="text-muted">Toplam İş</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">1</h3>
                                                        <small class="text-muted">Devam Eden</small>
                                                    </div>
                                                    <div>
                                                        <h3 class="mb-0">3</h3>
                                                        <small class="text-muted">Tamamlanan</small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-3">
                                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 25%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materials Tab -->
            <div class="tab-pane fade" id="materials">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Malzeme Yönetimi</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary">Tümü</button>
                                    <button class="btn btn-sm btn-outline-secondary">Stokta Olanlar</button>
                                    <button class="btn btn-sm btn-outline-secondary active">Kritik Stok</button>
                                    <button class="btn btn-sm btn-outline-secondary">Sipariş Bekleyenler</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Malzeme Kodu</th>
                                                <th>Malzeme Adı</th>
                                                <th>Stok Miktarı</th>
                                                <th>Minimum Stok</th>
                                                <th>Tedarik Süresi</th>
                                                <th>Son Sipariş Tarihi</th>
                                                <th>Durum</th>
                                                <th>İşlemler</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="material-critical">
                                                <td>137998%</td>
                                                <td>Siemens 7SR1003-1JA20-2DA0+ZY20 24VDC</td>
                                                <td>2</td>
                                                <td>5</td>
                                                <td>15 gün</td>
                                                <td>10.10.2024</td>
                                                <td><span class="badge bg-danger">Kritik</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">Sipariş Ekle</button>
                                                </td>
                                            </tr>
                                            <tr class="material-required">
                                                <td>144866%</td>
                                                <td>KAP-80/190-95 Akım Trafosu</td>
                                                <td>3</td>
                                                <td>5</td>
                                                <td>10 gün</td>
                                                <td>15.10.2024</td>
                                                <td><span class="badge bg-warning">Düşük</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">Sipariş Ekle</button>
                                                </td>
                                            </tr>
                                            <tr class="material-required">
                                                <td>120170%</td>
                                                <td>M480TB/G-027-95.300UN5 Kablo Başlığı</td>
                                                <td>12</td>
                                                <td>15</td>
                                                <td>7 gün</td>
                                                <td>20.10.2024</td>
                                                <td><span class="badge bg-warning">Düşük</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">Sipariş Ekle</button>
                                                </td>
                                            </tr>
                                            <tr class="material-available">
                                                <td>109367%</td>
                                                <td>582mm Bara</td>
                                                <td>25</td>
                                                <td>10</td>
                                                <td>5 gün</td>
                                                <td>05.10.2024</td>
                                                <td><span class="badge bg-success">Yeterli</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">Detay</button>
                                                </td>
                                            </tr>
                                            <tr class="material-available">
                                                <td>109363%</td>
                                                <td>432mm Bara</td>
                                                <td>18</td>
                                                <td>10</td>
                                                <td>5 gün</td>
                                                <td>05.10.2024</td>
                                                <td><span class="badge bg-success">Yeterli</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary">Detay</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Malzeme Tahminleri</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="materialForecastChart" height="300"></canvas>
                            </div>
                        </div>
                        <div class="card mt-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Son Siparişler</h5>
                                <a href="#" class="btn btn-sm btn-outline-primary">Tümü</a>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">#PO-2024-1025</h6>
                                            <small class="text-muted">2 gün önce</small>
                                        </div>
                                        <p class="mb-1">Siemens 7SR1003-1JA20-2DA0+ZY20 24VDC</p>
                                        <small class="text-muted">Miktar: 5, Tahmini Teslim: 25.11.2024</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">#PO-2024-1024</h6>
                                            <small class="text-muted">5 gün önce</small>
                                        </div>
                                        <p class="mb-1">KAP-80/190-95 Akım Trafosu</p>
                                        <small class="text-muted">Miktar: 3, Tahmini Teslim: 20.11.2024</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">#PO-2024-1023</h6>
                                            <small class="text-muted">1 hafta önce</small>
                                        </div>
                                        <p class="mb-1">M480TB/G-027-95.300UN5 Kablo Başlığı</p>
                                        <small class="text-muted">Miktar: 10, Tahmini Teslim: 15.11.2024</small>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planning Tab -->
            <div class="tab-pane fade" id="planning">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Üretim Planlama</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary">Günlük</button>
                                    <button class="btn btn-sm btn-outline-secondary active">Haftalık</button>
                                    <button class="btn btn-sm btn-outline-secondary">Aylık</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="productionCalendar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Kapasite Planlama</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="capacityDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        Tüm Birimler
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="capacityDropdown">
                                        <li><a class="dropdown-item" href="#">Elektrik Tasarım</a></li>
                                        <li><a class="dropdown-item" href="#">Mekanik Tasarım</a></li>
                                        <li><a class="dropdown-item" href="#">Satın Alma</a></li>
                                        <li><a class="dropdown-item" href="#">Mekanik Üretim</a></li>
                                        <li><a class="dropdown-item" href="#">İç Montaj</a></li>
                                        <li><a class="dropdown-item" href="#">Kablaj</a></li>
                                        <li><a class="dropdown-item" href="#">Genel Montaj</a></li>
                                        <li><a class="dropdown-item" href="#">Test</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="capacityChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Teslimat Tahminleri</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="deliveryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        Son 30 Gün
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="deliveryDropdown">
                                        <li><a class="dropdown-item" href="#">Son 7 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Son 30 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Son 90 Gün</a></li>
                                        <li><a class="dropdown-item" href="#">Bu Yıl</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="deliveryChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane fade" id="reports">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Raporlar ve Analizler</h5>
                                <div class="dropdown">
                                    <button class="btn btn-primary dropdown-toggle" type="button" id="reportsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-download"></i> Rapor Al
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="reportsDropdown">
                                        <li><a class="dropdown-item" href="#">Üretim Raporu</a></li>
                                        <li><a class="dropdown-item" href="#">Malzeme Raporu</a></li>
                                        <li><a class="dropdown-item" href="#">Gecikme Raporu</a></li>
                                        <li><a class="dropdown-item" href="#">Verimlilik Raporu</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="#">Özel Rapor Oluştur</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-4">
                                            <div class="card-header">
                                                <h6 class="mb-0">Üretim Verimliliği</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="efficiencyChart" height="250"></canvas>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">Gecikme Nedenleri</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="delayChart" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-4">
                                            <div class="card-header">
                                                <h6 class="mb-0">Birim Bazlı Çalışma Süreleri</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="unitTimeChart" height="250"></canvas>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">Müşteri Bazlı Siparişler</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="customerChart" height="250"></canvas>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0">Uyarı Çözüm Analizi</h6>
                                            </div>
                                            <div class="card-body">
                                                <canvas id="alertResolutionChart" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Uyarı ve Çözüm Takip Analizi</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary active">Son 30 Gün</button>
                                    <button class="btn btn-sm btn-outline-secondary">Son 90 Gün</button>
                                    <button class="btn btn-sm btn-outline-secondary">Tüm Zamanlar</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Birim</th>
                                                <th>Toplam Uyarı</th>
                                                <th>Çözülen</th>
                                                <th>Çözüm Süresi (Ort.)</th>
                                                <th>Çözüm Oranı</th>
                                                <th>Tekrarlayan Sorunlar</th>
                                                <th>Performans</th>
                                            </tr>
                                        </thead>
                                        <tbody id="departmentAnalyticsTable">
                                            <tr>
                                                <td>Mekanik Üretim</td>
                                                <td>15</td>
                                                <td>12</td>
                                                <td>4.2 saat</td>
                                                <td>80%</td>
                                                <td>3</td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 80%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Satın Alma</td>
                                                <td>12</td>
                                                <td>10</td>
                                                <td>6.8 saat</td>
                                                <td>83%</td>
                                                <td>1</td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 83%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Kablaj</td>
                                                <td>8</td>
                                                <td>8</td>
                                                <td>2.1 saat</td>
                                                <td>100%</td>
                                                <td>0</td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Tab -->
            <div class="tab-pane fade" id="technical">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Teknik Dokümanlar</h5>
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#uploadDocumentModal">
                                    <i class="bi bi-upload"></i> Yükle
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="Doküman ara...">
                                    <button class="btn btn-outline-secondary" type="button">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">RM 36 CB Teknik Çizim</h6>
                                            <small class="text-muted">15.10.2024</small>
                                        </div>
                                        <p class="mb-1">Rev. 2.1 - Son güncelleme: Ahmet Yılmaz</p>
                                        <small class="text-muted">Elektrik Tasarım</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">RM 36 LB Montaj Talimatı</h6>
                                            <small class="text-muted">10.10.2024</small>
                                        </div>
                                        <p class="mb-1">Rev. 1.3 - Son güncelleme: Mehmet Demir</p>
                                        <small class="text-muted">Mekanik Tasarım</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">RM 36 FL Test Prosedürü</h6>
                                            <small class="text-muted">05.10.2024</small>
                                        </div>
                                        <p class="mb-1">Rev. 3.0 - Son güncelleme: Ayşe Kaya</p>
                                        <small class="text-muted">Test Birimi</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">RMU Kablaj Şeması</h6>
                                            <small class="text-muted">01.10.2024</small>
                                        </div>
                                        <p class="mb-1">Rev. 1.5 - Son güncelleme: Fatma Şahin</p>
                                        <small class="text-muted">Kablaj Birimi</small>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Teknik Sorgulama</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="technicalQuestion" class="form-label">Teknik sorunuzu yazın:</label>
                                    <textarea class="form-control" id="technicalQuestion" rows="3" placeholder="Örneğin: RM 36 CB hücresinde hangi akım trafosu kullanılır?"></textarea>
                                </div>
                                <button class="btn btn-primary">Sorgula</button>
                                <hr>
                                <div class="alert alert-info">
                                    <h6><i class="bi bi-lightbulb"></i> Yapay Zeka Cevabı:</h6>
                                    <p>RM 36 CB hücresinde genellikle 200-400/5-5A 5P20 7,5/15VA veya 300-600/5-5A 5P20 7,5/15VA özelliklerinde toroidal tip akım trafoları kullanılmaktadır. Canias kodları: 144866% (KAP-80/190-95) veya 142227% (KAT-85/190-95).</p>
                                    <p class="mb-0">Referans doküman: <a href="#">RM 36 CB Teknik Şartnamesi Rev.2.1</a></p>
                                </div>
                                <div class="mt-3">
                                    <h6>İlgili Dokümanlar:</h6>
                                    <ul>
                                        <li><a href="#">RM 36 CB Teknik Çizim</a> - Rev.2.1</li>
                                        <li><a href="#">Akım Trafosu Seçim Kılavuzu</a> - Rev.1.3</li>
                                        <li><a href="#">TEDAS-MLZ-2020-069 Teknik Şartname</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Sistem Ayarları</h5>
                            </div>
                            <div class="card-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="companyName" class="form-label">Şirket Adı</label>
                                        <input type="text" class="form-control" id="companyName" value="Mehmet Endüstriyel">
                                    </div>
                                    <div class="mb-3">
                                        <label for="timezone" class="form-label">Zaman Dilimi</label>
                                        <select class="form-select" id="timezone">
                                            <option selected>(UTC+03:00) İstanbul</option>
                                            <option>(UTC+01:00) Berlin</option>
                                            <option>(UTC+00:00) Londra</option>
                                            <option>(UTC-05:00) New York</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="dateFormat" class="form-label">Tarih Formatı</label>
                                        <select class="form-select" id="dateFormat">
                                            <option selected>DD.MM.YYYY (24.11.2024)</option>
                                            <option>MM/DD/YYYY (11/24/2024)</option>
                                            <option>YYYY-MM-DD (2024-11-24)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">ERP Entegrasyonu</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="erpIntegration" checked>
                                            <label class="form-check-label" for="erpIntegration">
                                                Canias ERP ile entegrasyon aktif
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Ayarları Kaydet</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Kullanıcı Yönetimi</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Ad Soyad</th>
                                                <th>Departman</th>
                                                <th>Rol</th>
                                                <th>Durum</th>
                                                <th>İşlem</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Ahmet Yılmaz</td>
                                                <td>Elektrik Tasarım</td>
                                                <td>Yönetici</td>
                                                <td><span class="badge bg-success">Aktif</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Mehmet Demir</td>
                                                <td>Mekanik Tasarım</td>
                                                <td>Kullanıcı</td>
                                                <td><span class="badge bg-success">Aktif</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Ayşe Kaya</td>
                                                <td>Test</td>
                                                <td>Kullanıcı</td>
                                                <td><span class="badge bg-success">Aktif</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Fatma Şahin</td>
                                                <td>Kablaj</td>
                                                <td>Kullanıcı</td>
                                                <td><span class="badge bg-secondary">Pasif</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                    <i class="bi bi-plus"></i> Yeni Kullanıcı Ekle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Yapay Zeka Ayarları</h5>
                            </div>
                            <div class="card-body">
                                <form>
                                    <div class="mb-3">
                                        <label class="form-label">Yapay Zeka Modülleri</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="aiProduction" checked>
                                            <label class="form-check-label" for="aiProduction">
                                                Üretim Tahmini Modülü
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="aiMaterial" checked>
                                            <label class="form-check-label" for="aiMaterial">
                                                Malzeme Tahmini Modülü
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="aiTechnical" checked>
                                            <label class="form-check-label" for="aiTechnical">
                                                Teknik Destek Modülü
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="aiAnalysis">
                                            <label class="form-check-label" for="aiAnalysis">
                                                Analiz Modülü (Deneysel)
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="aiModel" class="form-label">Model Seçimi</label>
                                        <select class="form-select" id="aiModel">
                                            <option selected>GPT-4 (OpenAI)</option>
                                            <option>GPT-3.5 Turbo (OpenAI)</option>
                                            <option>DeepSeek (Yerel Model)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="apiKey" class="form-label">API Anahtarı</label>
                                        <input type="password" class="form-control" id="apiKey" placeholder="sk-...">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Eğitim Verileri</label>
                                        <div class="form-text mb-2">Sistemin öğrenmesi için teknik dokümanları yükleyin:</div>
                                        <input type="file" class="form-control" multiple>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Ayarları Kaydet</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot -->
    <div class="ai-chatbot">
        <div class="ai-chatbot-btn" id="ai-chatbot-btn">
            <i class="bi bi-robot"></i>
            <span class="notification-badge">3</span>
        </div>
    </div>

    <!-- New Order Modal -->
    <div class="modal fade" id="newOrderModal" tabindex="-1" aria-labelledby="newOrderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newOrderModalLabel">Yeni Sipariş Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="orderNumber" class="form-label">Sipariş No</label>
                                <input type="text" class="form-control" id="orderNumber" value="AUTO-GENERATED" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="orderDate" class="form-label">Sipariş Tarihi</label>
                                <input type="date" class="form-control" id="orderDate">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="customer" class="form-label">Müşteri</label>
                                <select class="form-select" id="customer">
                                    <option selected>Seçiniz</option>
                                    <option>AYEDAŞ</option>
                                    <option>BEDAŞ</option>
                                    <option>TEİAŞ</option>
                                    <option>ENERJİSA</option>
                                    <option>OSMANİYE ELEKTRİK</option>
                                    <option>DİĞER</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="projectNumber" class="form-label">Proje No</label>
                                <input type="text" class="form-control" id="projectNumber">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="deliveryDate" class="form-label">Planlanan Teslim Tarihi</label>
                                <input type="date" class="form-control" id="deliveryDate">
                            </div>
                            <div class="col-md-6">
                                <label for="incoterm" class="form-label">Teslim Şekli (Incoterm)</label>
                                <select class="form-select" id="incoterm">
                                    <option selected>Seçiniz</option>
                                    <option>Nakliye Dahil, İndirme Hariç</option>
                                    <option>FCA - Fabrika Teslim</option>
                                    <option>FOB - Gemi Bordasında Teslim</option>
                                    <option>CIF - Mal Bedeli, Sigorta ve Navlun Ödenmiş Olarak Teslim</option>
                                </select>
                            </div>
                        </div>
                        <hr>
                        <h5 class="mb-3">Hücre Bilgileri</h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="cellType" class="form-label">Hücre Tipi</label>
                                <select class="form-select" id="cellType">
                                    <option selected>Seçiniz</option>
                                    <option>RM 36 CB</option>
                                    <option>RM 36 LB</option>
                                    <option>RM 36 FL</option>
                                    <option>RMU</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="quantity" class="form-label">Miktar</label>
                                <input type="number" class="form-control" id="quantity" min="1" value="1">
                            </div>
                            <div class="col-md-4">
                                <label for="cellCode" class="form-label">Hücre Kodu</label>
                                <input type="text" class="form-control" id="cellCode">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="voltage" class="form-label">Çalışma Gerilimi</label>
                                <select class="form-select" id="voltage">
                                    <option selected>36kV</option>
                                    <option>24kV</option>
                                    <option>12kV</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="current" class="form-label">Nominal Çalışma Akımı</label>
                                <select class="form-select" id="current">
                                    <option selected>630A</option>
                                    <option>1250A</option>
                                    <option>2000A</option>
                                    <option>4000A</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="shortCircuit" class="form-label">Kısa Devre Akımı</label>
                                <select class="form-select" id="shortCircuit">
                                    <option selected>16kA</option>
                                    <option>20kA</option>
                                    <option>25kA</option>
                                    <option>31.5kA</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="controlVoltage" class="form-label">Kontrol Gerilimi</label>
                                <select class="form-select" id="controlVoltage">
                                    <option selected>24 VDC</option>
                                    <option>48 VDC</option>
                                    <option>110 VDC</option>
                                    <option>220 VAC</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="cellDescription" class="form-label">Teknik Değer ve Ürün Tanımı</label>
                            <textarea class="form-control" id="cellDescription" rows="2"></textarea>
                        </div>
                        <hr>
                        <h5 class="mb-3">Ekipman Seçimleri</h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="currentTransformer" class="form-label">Akım Trafosu</label>
                                <select class="form-select" id="currentTransformer">
                                    <option selected>Seçiniz</option>
                                    <option>200-400/5-5A 5P20 7,5/15VA</option>
                                    <option>300-600/5-5A 5P20 7,5/15VA</option>
                                    <option>400-800/5-5A 5P20 7,5/15VA</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="voltageTransformer" class="form-label">Gerilim Trafosu (Canias Kodu)</label>
                                <input type="text" class="form-control" id="voltageTransformer">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="breakerMotor" class="form-label">Kesici Motor Bobin</label>
                                <input type="text" class="form-control" id="breakerMotor" value="24 VDC">
                            </div>
                            <div class="col-md-6">
                                <label for="disconnectorMotor" class="form-label">Ayırıcı Motor Bobin</label>
                                <input type="text" class="form-control" id="disconnectorMotor" value="24 VDC">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="relay" class="form-label">Röle (Canias Kodu)</label>
                                <input type="text" class="form-control" id="relay" value="137998%">
                            </div>
                            <div class="col-md-6">
                                <label for="energyAnalyzer" class="form-label">Enerji Analizörü (Canias Kodu)</label>
                                <input type="text" class="form-control" id="energyAnalyzer">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="surgeArrester" class="form-label">AGD</label>
                                <input type="text" class="form-control" id="surgeArrester" value="OVI+S (10nf)">
                            </div>
                            <div class="col-md-6">
                                <label for="meter" class="form-label">Sayaç (Canias Kodu)</label>
                                <input type="text" class="form-control" id="meter">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="fuse" class="form-label">YG Sigorta (Marka, Tip)</label>
                                <input type="text" class="form-control" id="fuse">
                            </div>
                            <div class="col-md-6">
                                <label for="voltageIndicator" class="form-label">Gerilim Gösterge Tipi</label>
                                <input type="text" class="form-control" id="voltageIndicator">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="dcSupply" class="form-label">DC Besleme Grubu</label>
                                <input type="text" class="form-control" id="dcSupply">
                            </div>
                            <div class="col-md-6">
                                <label for="cableHead" class="form-label">Kablo Başlığı (Canias Kodu)</label>
                                <input type="text" class="form-control" id="cableHead" value="120170%">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="busbar" class="form-label">Diziliş Bara (Canias Kodu)</label>
                                <input type="text" class="form-control" id="busbar" value="109367%">
                            </div>
                            <div class="col-md-6">
                                <label for="closureDetail" class="form-label">Kapama Detayı</label>
                                <input type="text" class="form-control" id="closureDetail">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="otherFeatures" class="form-label">Diğer Özellikler</label>
                            <textarea class="form-control" id="otherFeatures" rows="2" placeholder="Örneğin: *Motorlu *Kablo başlıkları Euromold marka. *UKD 10 m."></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Özel Tasarım Gerekli Mi?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="customDesign" id="customDesignNo" checked>
                                <label class="form-check-label" for="customDesignNo">
                                    Gerekli değil
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="customDesign" id="customDesignYes">
                                <label class="form-check-label" for="customDesignYes">
                                    Gerekli
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kilitleme Çalışması Gerekli Mi?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="lockingWork" id="lockingWorkNo" checked>
                                <label class="form-check-label" for="lockingWorkNo">
                                    Gerekli değil
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="lockingWork" id="lockingWorkYes">
                                <label class="form-check-label" for="lockingWorkYes">
                                    Gerekli
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Etiket ve Dil Bilgileri</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="standardTurkish" checked>
                                <label class="form-check-label" for="standardTurkish">
                                    Standart Türkçe
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="energysaStandard">
                                <label class="form-check-label" for="energysaStandard">
                                    Standart EnerjiSA RM + RMU (RM36CB'nin ayırıcılarında sayıcı olacak.)
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="referenceDocuments" class="form-label">Referans Doküman No</label>
                            <textarea class="form-control" id="referenceDocuments" rows="2" placeholder="Örneğin: *TEDAŞ-MLZ/95-002.D *EnerjiSA güncel ek şartnameleri"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="comments" class="form-label">Yorumlar</label>
                            <textarea class="form-control" id="comments" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-primary">Siparişi Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Document Modal -->
    <div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="uploadDocumentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadDocumentModalLabel">Teknik Doküman Yükle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="documentName" class="form-label">Doküman Adı</label>
                            <input type="text" class="form-control" id="documentName">
                        </div>
                        <div class="mb-3">
                            <label for="documentType" class="form-label">Doküman Türü</label>
                            <select class="form-select" id="documentType">
                                <option selected>Seçiniz</option>
                                <option>Teknik Çizim</option>
                                <option>Montaj Talimatı</option>
                                <option>Test Prosedürü</option>
                                <option>Teknik Şartname</option>
                                <option>Diğer</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="documentDepartment" class="form-label">İlgili Birim</label>
                            <select class="form-select" id="documentDepartment">
                                <option selected>Seçiniz</option>
                                <option>Elektrik Tasarım</option>
                                <option>Mekanik Tasarım</option>
                                <option>Satın Alma</option>
                                <option>Mekanik Üretim</option>
                                <option>İç Montaj</option>
                                <option>Kablaj</option>
                                <option>Genel Montaj</option>
                                <option>Test</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="documentRevision" class="form-label">Revizyon No</label>
                            <input type="text" class="form-control" id="documentRevision" placeholder="Örneğin: 1.0">
                        </div>
                        <div class="mb-3">
                            <label for="documentFile" class="form-label">Dosya Seçin</label>
                            <input class="form-control" type="file" id="documentFile">
                        </div>
                        <div class="mb-3">
                            <label for="documentDescription" class="form-label">Açıklama</label>
                            <textarea class="form-control" id="documentDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-primary">Yükle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Yeni Kullanıcı Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="userName" class="form-label">Ad Soyad</label>
                            <input type="text" class="form-control" id="userName">
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">E-posta</label>
                            <input type="email" class="form-control" id="userEmail">
                        </div>
                        <div class="mb-3">
                            <label for="userDepartment" class="form-label">Departman</label>
                            <select class="form-select" id="userDepartment">
                                <option selected>Seçiniz</option>
                                <option>Satış</option>
                                <option>Proje Yönetimi</option>
                                <option>Elektrik Tasarım</option>
                                <option>Mekanik Tasarım</option>
                                <option>Satın Alma</option>
                                <option>Mekanik Üretim</option>
                                <option>İç Montaj</option>
                                <option>Kablaj</option>
                                <option>Genel Montaj</option>
                                <option>Test</option>
                                <option>Yönetim</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="userRole" class="form-label">Rol</label>
                            <select class="form-select" id="userRole">
                                <option selected>Kullanıcı</option>
                                <option>Yönetici</option>
                                <option>Süper Yönetici</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="userPassword" class="form-label">Şifre</label>
                            <input type="password" class="form-control" id="userPassword">
                        </div>
                        <div class="mb-3">
                            <label for="userPasswordConfirm" class="form-label">Şifre Tekrar</label>
                            <input type="password" class="form-control" id="userPasswordConfirm">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="userActive" checked>
                                <label class="form-check-label" for="userActive">
                                    Kullanıcı aktif
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-primary">Kullanıcı Ekle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot Modal -->
    <div class="modal fade" id="aiChatModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Yapay Zeka Asistan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="height: 400px; overflow-y: auto;">
                    <div id="chatMessages"></div>
                </div>
                <div class="modal-footer">
                    <div class="input-group">
                        <input type="text" id="aiChatInput" class="form-control" placeholder="Soru sorun...">
                        <button class="btn btn-primary" id="sendChatBtn">Gönder</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Not ve Uyarı Sistemi Modalleri -->
    <div class="modal fade" id="alertDetailModal" tabindex="-1" aria-labelledby="alertDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="alertDetailModalLabel">Uyarı Detayı</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert-detail-container">
                        <div class="alert" id="alertDetailContent">
                            <!-- Uyarı detayları buraya JavaScript ile eklenecek -->
                        </div>
                        
                        <div class="alert-note-header mt-4 mb-2">
                            <h6>Yanıtlar ve Takip</h6>
                        </div>
                        
                        <div id="alertResponsesContainer">
                            <!-- Yanıtlar buraya JavaScript ile eklenecek -->
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert-response-form mt-3" id="alertResponseForm">
                        <h6>Yanıt Ekle</h6>
                        <form id="addResponseForm">
                            <div class="mb-3">
                                <label for="responseType" class="form-label">Yanıt Tipi</label>
                                <select class="form-select" id="responseType">
                                    <option value="solved">Sorun Çözüldü</option>
                                    <option value="in-progress">Üzerinde Çalışılıyor</option>
                                    <option value="delayed">Ertelendi (Nedeni Belirtin)</option>
                                    <option value="reassign">Başka Birime Aktarılmalı</option>
                                    <option value="needs-info">Daha Fazla Bilgi Gerekli</option>
                                    <option value="cant-solve">Çözülemiyor (Yönetim Kararı Gerekli)</option>
                                </select>
                            </div>
                            <div class="mb-3" id="delayTimeContainer" style="display:none;">
                                <label for="delayTime" class="form-label">Erteleme Süresi</label>
                                <select class="form-select" id="delayTime">
                                    <option value="1">1 Gün</option>
                                    <option value="2">2 Gün</option>
                                    <option value="3">3 Gün</option>
                                    <option value="5">5 Gün</option>
                                    <option value="7">1 Hafta</option>
                                    <option value="14">2 Hafta</option>
                                </select>
                            </div>
                            <div class="mb-3" id="reassignDepartmentContainer" style="display:none;">
                                <label for="reassignDepartment" class="form-label">Sorumlu Birim</label>
                                <select class="form-select" id="reassignDepartment">
                                    <option value="sales">Satış</option>
                                    <option value="design-electrical">Elektrik Tasarım</option>
                                    <option value="design-mechanical">Mekanik Tasarım</option>
                                    <option value="purchasing">Satın Alma</option>
                                    <option value="production-mechanical">Mekanik Üretim</option>
                                    <option value="production-assembly">Montaj</option>
                                    <option value="production-wiring">Kablaj</option>
                                    <option value="quality">Kalite Kontrol</option>
                                    <option value="testing">Test</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="responseComment" class="form-label">Açıklama</label>
                                <textarea class="form-control" id="responseComment" rows="3" placeholder="Yanıtınızla ilgili detayları yazın..."></textarea>
                            </div>
                            <button type="button" class="btn btn-primary" id="submitAlertResponse">Yanıtı Gönder</button>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tüm Uyarılar Modalı -->
    <div class="modal fade" id="allAlertsModal" tabindex="-1" aria-labelledby="allAlertsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="allAlertsModalLabel">Tüm Uyarılar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert-filters mb-3">
                        <div class="row">
                            <div class="col-md-3">
                                <select class="form-select" id="alertTypeFilter">
                                    <option value="all" selected>Tüm Uyarı Tipleri</option>
                                    <option value="red">Kritik Uyarılar</option>
                                    <option value="yellow">Önemli Uyarılar</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="alertStatusFilter">
                                    <option value="all" selected>Tüm Durumlar</option>
                                    <option value="pending">Yanıt Bekleyenler</option>
                                    <option value="inprogress">Çözüm Sürecindekiler</option>
                                    <option value="resolved">Çözülenler</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="departmentFilter">
                                    <option value="all" selected>Tüm Birimler</option>
                                    <option value="sales">Satış</option>
                                    <option value="design-electrical">Elektrik Tasarım</option>
                                    <option value="design-mechanical">Mekanik Tasarım</option>
                                    <option value="purchasing">Satın Alma</option>
                                    <option value="production-mechanical">Mekanik Üretim</option>
                                    <option value="production-assembly">Montaj</option>
                                    <option value="production-wiring">Kablaj</option>
                                    <option value="quality">Kalite Kontrol</option>
                                    <option value="testing">Test</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" id="applyAlertFilters">Filtrele</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="allAlertsTable">
                            <thead>
                                <tr>
                                    <th>Uyarı ID</th>
                                    <th>Sipariş No</th>
                                    <th>Öncelik</th>
                                    <th>Konu</th>
                                    <th>Birim</th>
                                    <th>Oluşturulma</th>
                                    <th>Durum</th>
                                    <th>Kalan Süre</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Uyarı listesi JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="exportAlerts">
                        <i class="bi bi-download"></i> Dışa Aktar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Yeni Uyarı Oluşturma Modalı -->
    <div class="modal fade" id="createAlertModal" tabindex="-1" aria-labelledby="createAlertModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createAlertModalLabel">Yeni Uyarı/Not Oluştur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createAlertForm">
                        <input type="hidden" id="alertOrderId" value="">
                        
                        <div class="mb-3">
                            <label for="alertTitle" class="form-label">Konu</label>
                            <input type="text" class="form-control" id="alertTitle" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="alertDescription" class="form-label">Açıklama</label>
                            <textarea class="form-control" id="alertDescription" rows="3" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="alertPriority" class="form-label">Öncelik Seviyesi</label>
                            <select class="form-select" id="alertPriority" required>
                                <option value="yellow">Önemli (Sarı)</option>
                                <option value="red">Kritik (Kırmızı)</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="alertDepartment" class="form-label">Sorumlu Birim</label>
                            <select class="form-select" id="alertDepartment" required>
                                <option value="" selected disabled>Birim seçin...</option>
                                <option value="sales">Satış</option>
                                <option value="design-electrical">Elektrik Tasarım</option>
                                <option value="design-mechanical">Mekanik Tasarım</option>
                                <option value="purchasing">Satın Alma</option>
                                <option value="production-mechanical">Mekanik Üretim</option>
                                <option value="production-assembly">Montaj</option>
                                <option value="production-wiring">Kablaj</option>
                                <option value="quality">Kalite Kontrol</option>
                                <option value="testing">Test</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="saveAlertBtn">Uyarıyı Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js" crossorigin="anonymous"></script>
    
    <!-- Config -->
    <script src="config/app-config.js"></script>
    
    <!-- Core Utilities -->
    <script src="core/logger.js"></script>
    <script src="utils/event-bus.js"></script>
    
    <!-- Services -->
    <script src="services/api-service.js"></script>
    <script src="services/erp-service.js"></script>
    <script src="services/ai-service.js"></script>
    
    <!-- Core -->
    <script src="core/compat-check.js"></script>
    <script src="core/firebase-config.js"></script>
    <script src="core/mock-firebase.js"></script>
    
    <!-- AI Modules -->
    <script src="modules/ai/advanced-ai.js"></script>
    <script src="modules/ai/chatbot.js"></script>
    <script src="modules/ai/ai-analytics.js"></script>
    <script src="modules/ai/ai-integration.js"></script>
    
    <!-- App Modules -->
    <script src="modules/dashboard/dashboard.js"></script>
    <script src="modules/orders/orders.js"></script>
    <script src="modules/production/production.js"></script>
    
    <!-- App Core -->
    <script src="core/app.js"></script>
    <script src="core/main.js"></script>
    
        <!-- Yapay Zeka JS Functions -->
    <script>
        // Hoşgeldiniz mesajı
        function getWelcomeMessage() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) {
                greeting = "Günaydın";
            } else if (hour < 18) {
                greeting = "İyi günler";
            } else {
                greeting = "İyi akşamlar";
            }
            
            return `${greeting}! Ben METS Yapay Zeka Asistanınızım. Üretim takibi, malzeme yönetimi, raporlama ve analiz konularında yardımcı olabilirim. Farklı modları kullanarak spesifik ihtiyaçlarınıza yönelik hizmet alabilirsiziniz. Nasıl yardımcı olabilirim?`;
        }

        // AI mesajını formatla ve ekrana yazdır
        function displayAIMessage(message, scrollToBottom = true) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message ai-message mb-3';
            
            // Markdown benzeri formatlama desteği
            let formattedMessage = message
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            // URL'leri bağlantıya dönüştür
            formattedMessage = formattedMessage.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>');
            
            // Aksiyon butonları ekleme
            if (message.includes('[Rapor Oluştur]')) {
                formattedMessage = formattedMessage.replace(/\[Rapor Oluştur\]\(report\)/g, 
                    '<button class="btn btn-sm btn-warning ms-2 report-action-btn"><i class="bi bi-file-earmark-text"></i> Rapor Oluştur</button>');
            }
            
            if (message.includes('[Tahmin Göster]')) {
                formattedMessage = formattedMessage.replace(/\[Tahmin Göster\]\(prediction\)/g, 
                    '<button class="btn btn-sm btn-success ms-2 prediction-action-btn"><i class="bi bi-graph-up-arrow"></i> Tahmin Göster</button>');
            }
            
            messageElement.innerHTML = formattedMessage;
            messagesContainer.appendChild(messageElement);
            
            // Buton işlevselliklerini ekle
            if (message.includes('[Rapor Oluştur]')) {
                const reportBtn = messageElement.querySelector('.report-action-btn');
                if (reportBtn) {
                    reportBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showReportModal();
                    });
                }
            }
            
            if (message.includes('[Tahmin Göster]')) {
                const predictionBtn = messageElement.querySelector('.prediction-action-btn');
                if (predictionBtn) {
                    predictionBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showPredictionModal();
                    });
                }
            }
            
            if (scrollToBottom) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Kullanıcı mesajını ekrana yazdır
        function displayUserMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message user-message mb-3';
            
            // Mesajı HTML güvenli hale getir
            const safeMessage = message
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            
            messageElement.innerHTML = safeMessage;
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Mod değiştirme mesajı
        function getModeSwitchMessage(mode) {
            const modeSwitchMessages = {
                'assistant': "Asistan moduna geçtim. Size günlük işlerinizde yardımcı olacağım. Sipariş durumları, malzeme takibi veya üretim bilgileri hakkında sorular sorabilirsiniz.",
                'analyst': "Analiz moduna geçtim. Bu modda üretim verileri, performans metrikleri ve verimlilik analizleri hakkında derinlemesine analizler sunabilirim.",
                'reporter': "Rapor moduna geçtim. Toplantılar, üretim durumu ve performans hakkında özetler ve raporlar oluşturabilirim. [Rapor Oluştur](report) butonuna tıklayarak detaylı rapor hazırlayabilirim.",
                'predictor': "Tahmin moduna geçtim. Üretim gecikmeleri, kaynak ihtiyaçları ve potansiyel darboğazlar için öngörüler ve çözüm önerileri sunacağım. [Tahmin Göster](prediction) butonuyla detaylı analiz görebilirsiniz.",
                'expert': "Uzman moduna geçtim. Bu modda teknik sorunlara, optimizasyon önerilerine ve ileri seviye çözümlere odaklanacağım. Karmaşık üretim sorunları hakkında sorular sorabilirsiniz."
            };
            
            return modeSwitchMessages[mode] || "Mod değiştirildi. Size nasıl yardımcı olabilirim?";
        }

        // Asistan modu cevap oluşturma
        function generateAssistantResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            // Basit anahtar kelime kontrolü
            if (userMessageLower.includes('merhaba') || userMessageLower.includes('selam') || userMessageLower.includes('nasıl')) {
                return "Merhaba! Size nasıl yardımcı olabilirim?";
            }
            
            if (userMessageLower.includes('sipariş') || userMessageLower.includes('durum')) {
                return `Mevcut siparişlerin durumu şu şekilde:
                
1. #0424-1233: Üretim tamamlandı, test aşamasında
2. #0424-1245: Mekanik montaj tamamlandı, elektrik testinde
3. #0424-1251: Malzeme bekleniyor, 3 gün gecikme var
4. #0424-1260: Tasarım aşamasında, zamanında ilerliyor
5. #0424-1272: Yeni başladı, malzeme tedariği yapılıyor

Daha detaylı bilgi için hangi sipariş hakkında bilgi almak istersiniz?`;
            }
            
            if (userMessageLower.includes('malzeme') || userMessageLower.includes('stok')) {
                return `Kritik stok seviyesindeki malzemeler:
                
- Siemens rölesi (2 adet, 8 adet ihtiyaç)
- KAP-80/190-95 Akım Trafosu (3 adet, 5 adet ihtiyaç)
- M480TB/G-027-95.300UN5 Kablo Başlığı (12 adet, 15 adet ihtiyaç)

Bu malzemelerin tedariki için satın alma departmanıyla görüşme başlatıldı. Alternatif tedarikçiler araştırılıyor.`;
            }
            
            if (userMessageLower.includes('gecikme') || userMessageLower.includes('risk')) {
                return `Teslimat gecikme riski olan siparişler:
                
1. #0424-1251: Akım trafosu tedarik gecikmesi (1 hafta)
2. #0424-1260: Tasarım revizyonu gerekebilir (potansiyel 3-5 gün)

Gecikmeleri önlemek için aşağıdaki aksiyonlar alındı:
- Alternatif tedarikçi araştırması
- Ek mesai planlaması
- Öncelik sıralaması güncellendi`;
            }
            
            if (userMessageLower.includes('görev') || userMessageLower.includes('bugün')) {
                return `Bugün tamamlanması planlanan görevler:
                
1. #0424-1233 sipariş için elektriksel testlerin bitirilmesi
2. #0424-1245 için kablo bağlantı işlemlerinin tamamlanması
3. #0424-1251 için alternatif tedarikçi görüşmeleri
4. Haftalık üretim toplantısı (14:00)
5. Kalite kontrol raporunun hazırlanması

Bu görevlerden hangisi hakkında daha detaylı bilgi almak istersiniz?`;
            }
            
            // Genel cevap
            return `Üretim takip sistemindeki verilere göre şu anki durum şöyle:

- Aktif 5 üretim siparişi mevcut
- 2 sipariş teslimat aşamasında
- 1 siparişte tedarik kaynaklı gecikme söz konusu
- Kalite kontrol testlerinde bugün 3 ürün onaylandı

Daha detaylı bilgi için sipariş durumları, malzeme stokları veya üretim planı hakkında sorular sorabilirsiniz.`;
        }

        // Analist modu cevap oluşturma
        function generateAnalysisResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('verimlilik') || userMessageLower.includes('performans')) {
                return `**Son 30 Günün Verimlilik Analizi**

| Birim | Plan Gerçekleşme | Gecikme | Kalite Skoru |
|-------|------------------|---------|--------------|
| Mekanik Üretim | %92 | 3 gün | 4.7/5 |
| Elektrik Montaj | %87 | 5 gün | 4.5/5 |
| Kablaj | %96 | 1 gün | 4.8/5 |
| Test | %84 | 4 gün | 4.6/5 |

En büyük gecikme kaynaklarımız:
1. Malzeme tedarik süreçleri (%45)
2. Tasarım revizyonları (%30)
3. Test süreçleri (%15)
4. Diğer (%10)

Verimliliği artırmak için önerilen aksiyonlar:
- Tedarik zinciri optimizasyonu
- Test süreçlerinin otomasyonu
- Birimler arası koordinasyonun artırılması`;
            }
            
            if (userMessageLower.includes('gecikme') || userMessageLower.includes('sebep')) {
                return `**Gecikme Sebepleri Analizi**

Gecikmelerin ana nedenleri (son 3 ay verilerine göre):

1. **Malzeme Tedariki (45%)**
   - Akım trafosu tedarikindeki gecikmeler
   - Siemens röle tedariğindeki gecikmeler
   - Global tedarik zincirindeki sorunlar

2. **Tasarım Değişiklikleri (25%)**
   - Müşteri talepleri kaynaklı revizyonlar
   - Uyumluluk sorunları nedeniyle revizyonlar

3. **Üretim Kapasitesi Sorunları (15%)**
   - Mekanik üretim darboğazları
   - Kalifiye personel eksikliği

4. **Test Süreçleri (10%)**
   - Tekrarlanan hatalar
   - Test ekipmanı yetersizliği

5. **Diğer (5%)**

**İyileştirme Önerileri:**
- Alternatif tedarikçi havuzu oluşturulması
- Tasarım onay süreçlerinin iyileştirilmesi
- Üretim kapasitesinin artırılması`;
            }
            
            if (userMessageLower.includes('iş transfer') || userMessageLower.includes('birim')) {
                return `**Birimler Arası İş Transferinde Sorun Yaşanan Noktalar**

Son 60 günlük veri analizi sonuçları:

1. **Tasarım → Üretim Transferi**
   - Tasarım dokümanlarındaki eksiklikler
   - Revizyon kontrollerindeki hatalar
   - Teknik detay eksiklikleri

2. **Mekanik Üretim → Elektrik Montaj**
   - Fiziksel uyumsuzluklar
   - Standartlarda farklı yorumlar
   - Dokümantasyon eksiklikleri

3. **Montaj → Test**
   - Test öncesi kontrollerin eksikliği
   - Hata bildirimlerinin standart olmaması

**Önerilen İyileştirmeler:**
- Birimler arası dijital iş takip sisteminin iyileştirilmesi
- Standart transfer kontrol listelerinin güncellenmesi
- Önemli nokta kontrollerinin arttırılması
- Ekipler arası düzenli koordinasyon toplantıları`;
            }
            
            // Genel analiz cevabı
            return `**Üretim Analiz Raporu**

Son 30 günlük veriler analiz edildiğinde:

- Üretim verimliliği: %85 (geçen aya göre %3 artış)
- Ortalama teslimat gecikme süresi: 4.2 gün (geçen aya göre 0.8 gün azalma)
- Kalite red oranı: %3.1 (geçen aya göre %0.7 iyileşme)
- Malzeme tedarik performansı: %78 (geçen aya göre %5 azalma)

**Kritik Noktalar:**
- Mekanik üretimde verimlilik artışı sağlandı
- Elektrik montajda kalite sorunları azaldı
- Malzeme tedarikinde yaşanan sorunlar üretimdeki en büyük gecikme sebebi

Daha detaylı analiz için lütfen spesifik bir alan veya dönem belirtiniz.`;
        }

        // Rapor modu cevap oluşturma
        function generateReporterResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('üretim durum') || userMessageLower.includes('özetle')) {
                return `**Günlük Üretim Durumu Özeti**

Bugünkü üretim durumu ile ilgili genel özet:

- Aktif sipariş sayısı: 8
- Planlanan görev sayısı: 24
- Tamamlanan görev sayısı: 18
- Plan gerçekleşme oranı: %75

**Kritik durumlar:**
- #0424-1251 siparişinde malzeme tedarik gecikmesi (1 hafta)
- Mekanik üretimde kapasite sorunu (%110 yük)
- Test laboratuvarında 2 hücre testi bekliyor

Size daha detaylı bir rapor hazırlayabilirim. [Rapor Oluştur](report) butonuna tıklayarak özelleştirilmiş rapor oluşturabilirsiniz.`;
            }
            
            if (userMessageLower.includes('performans özet') || userMessageLower.includes('haftalık')) {
                return `**Haftalık Performans Özeti**

Geçen haftanın üretim performansı analizi:

- Tamamlanan sipariş sayısı: 3
- Başlayan yeni sipariş sayısı: 2
- Ortalama sipariş tamamlama süresi: 18 gün
- Kalite uygunsuzluğu tespit edilen ürün sayısı: 2
- Kalite düzeltme için harcanan toplam süre: 16 saat

**Başarılı Alanlar:**
- Mekanik üretim hedefin %5 üzerinde performans gösterdi
- Test süreleri ortalama 1.5 gün azaldı

**İyileştirme Gereken Alanlar:**
- Malzeme tedarik süreçlerinin iyileştirilmesi
- Tasarım revizyonlarının azaltılması

Detaylı haftalık rapor için [Rapor Oluştur](report) butonuna tıklayabilirsiniz.`;
            }
            
            if (userMessageLower.includes('toplantı') || userMessageLower.includes('yönetim')) {
                return `**Yönetim Toplantısı için Özet Rapor**

Toplantıda sunulmak üzere hazırlanmış özet:

**Üretim:**
- 8 aktif sipariş, 3 tamamlanma aşamasında
- Kapasite kullanımı: %92
- Kritik gecikme riski: 1 sipariş (#0424-1251)

**Kalite:**
- Kalite red oranı: %2.8
- Tekrarlayan sorun: Kablo bağlantı hataları

**Finans:**
- Malzeme maliyet sapması: +%3.5
- İş gücü maliyet sapması: -%1.2

**Alınması Gereken Aksiyonlar:**
1. Akım trafosu tedarikçi alternatifi belirlenmesi
2. Kablo bağlantılarında kalite kontrol artırımı
3. Mekanik üretim kapasitesinin değerlendirilmesi

Tam rapor için [Rapor Oluştur](report) butonunu kullanabilirsiniz.`;
            }
            
            // Genel rapor cevabı
            return `Size kapsamlı bir rapor hazırlayabilirim. Rapor türünü ve içeriğini belirlemek için [Rapor Oluştur](report) butonuna tıklayabilir veya aşağıdaki seçeneklerden biriyle ilgili sorabilirsiniz:

1. Günlük üretim durumu özeti
2. Haftalık performans raporu
3. Malzeme durum raporu
4. Yönetim toplantısı özeti
5. Kalite kontrol raporu

Hangisi hakkında bilgi almak istersiniz?`;
        }

        // Tahmin modu cevap oluşturma
        function generatePredictionResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('üretim kapasite') || userMessageLower.includes('yeterli')) {
                return `**Üretim Kapasite Tahmini (Önümüzdeki 30 gün)**

Yapay zeka modelim mevcut üretim planı, tarihsel veriler ve kapasite bilgilerine göre analiz yaptı.

**Özet Tahmin:**
Önümüzdeki ay için mevcut kapasiteniz %92 oranında dolacak. Öngörülen sipariş artışları ile birlikte 3. haftada kapasite aşımı riski bulunmaktadır.

**Birim Bazlı Tahminler:**
- Mekanik Üretim: %105 (Kapasite Aşımı!)
- Elektrik Montaj: %85
- Kablaj: %78
- Test: %95

**Potansiyel Darboğazlar:**
- 15-20 Kasım tarihleri arasında mekanik üretimde kapasite aşımı
- 22-25 Kasım tarihleri arasında test biriminde yoğunluk

**Öneriler:**
1. Mekanik üretim için ek vardiya planlaması
2. Test işlemleri için önceliklendirme
3. Yoğun dönem için ekstra kaynak planlaması

Daha detaylı analiz için [Tahmin Göster](prediction) butonuna tıklayabilirsiniz.`;
            }
            
            if (userMessageLower.includes('teslimat gecikme') || userMessageLower.includes('gecikme risk')) {
                return `**Teslimat Gecikme Riski Tahmini**

Mevcut üretim verilerine göre yapılan analiz sonucunda:

**Yüksek Gecikme Riski Olan Siparişler:**
1. #0424-1251: %85 gecikme riski (ortalama 7-10 gün)
   *Sebep: Akım trafosu tedarik gecikmesi*
   
2. #0424-1260: %60 gecikme riski (ortalama 3-5 gün)
   *Sebep: Tasarım revizyonları ve mekanik üretim yoğunluğu*

**Orta Dereceli Gecikme Riski:**
3. #0424-1270: %40 gecikme riski (ortalama 2-4 gün)
   *Sebep: Test süreçlerindeki olası gecikmeler*

**Risk Azaltma Önerileri:**
- #0424-1251 için alternatif tedarikçi kullanımı (%85 risk → %40 risk)
- #0424-1260 için tasarım ekibiyle acil değerlendirme toplantısı
- Kritik siparişler için kaynak önceliklendirmesi

Detaylı tahmin analizi için [Tahmin Göster](prediction) butonunu kullanabilirsiniz.`;
            }
            
            if (userMessageLower.includes('malzeme tedarik') || userMessageLower.includes('stok sorun')) {
                return `**Malzeme Tedarik Risk Tahmini (Önümüzdeki 14 gün)**

Tedarik zinciri ve stok verileri analiz edildiğinde:

**Kritik Risk Noktaları:**
1. Akım trafosu (KAP-80/190-95): Stok 3 adet, İhtiyaç 8 adet
   *Tahmin: 10 gün içinde üretim duruşuna sebep olabilir*
   
2. Siemens koruma rölesi: Stok 2 adet, İhtiyaç 5 adet
   *Tahmin: 7 gün içinde kritik stok seviyesi*

3. Kablo başlığı (Raychem): Stok 6 adet, İhtiyaç 12 adet
   *Tahmin: 12 gün içinde kritik stok seviyesi*

**Tahmin Modeli Önerileri:**
- Akım trafoları için express teslimat seçeneği değerlendirilmeli
- Alternatif tedarikçilerle acil tedarik görüşmesi
- Bazı siparişlerde malzeme değişikliği (teknik açıdan uygun olanlarda)

Tüm tahmin analizini görmek için [Tahmin Göster](prediction) butonunu kullanabilirsiniz.`;
            }
            
            // Genel tahmin cevabı
            return `**Üretim ve Tedarik Tahmin Analizi**

Yapay zeka tahmin modelim, mevcut veriler ve tarihsel trendleri analiz ederek aşağıdaki tahminleri üretiyor:

**Üretim Tahminleri (30 gün):**
- Toplam üretim kapasitesi kullanımı: %92 (kritik seviye)
- Darboğaz riski: 15-20 Kasım tarihleri arasında mekanik üretim
- Tamamlanması öngörülen sipariş: 6 adet

**Tedarik Tahminleri:**
- Malzeme tedarik gecikme riski: 3 kritik kalem
- Stok yetersizliği riski: %40

**Teslimat Tahminleri:**
- Zamanında teslimat oranı: %80
- Gecikme riski yüksek siparişler: 2 adet

Detaylı tahmin analizleri ve senaryoları için [Tahmin Göster](prediction) butonuna tıklayabilirsiniz.`;
        }

        // Uzman modu cevap oluşturma
        function generateExpertResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('rm 36') || userMessageLower.includes('arıza')) {
                return `**RM 36 CB Hücresindeki Arıza Analizi**

Arıza veri analizi ve benzer vakalardan öğrendiğim bilgilere göre:

**Olası Nedenler (Olasılık sırasıyla):**
1. **Mekanik Kilitleme Mekanizması (72%)**
   - Kilitleme yayında yorulma
   - Hareket mekanizmasında hizalama sorunu
   - Montaj sırasında tolerans dışı durumlar

2. **Kontrol Devresinde Sorun (18%)**
   - Yardımcı kontak arızası
   - Kontrol kablolamasında oksitlenme/kopukluk
   - Motor sürücü devre arızası

3. **Anahtarlama Mekanizması (6%)**
   - Vakum tüplerde aşınma
   - Kontaklarda yanma/aşınma

4. **Diğer (4%)**
   - PCB arızası
   - Yazılım hatası

**Teknik Çözüm Önerileri:**
1. Kilitleme mekanizmasının komple sökülüp denetlenmesi
2. Mekanik hareket testi ve ayar kontrolü
3. Yardımcı kontakların değiştirilmesi
4. Mil hizalama kontrolü ve gerekirse ayarlanması

Önceki vaka analizlerinde, benzer sorunların %85'i mekanik kilitleme mekanizmasının komple revizyonu ile çözülmüştür.`;
            }
            
            if (userMessageLower.includes('mekanik montaj') || userMessageLower.includes('root cause')) {
                return `**Mekanik Montajda Yaşanan Sorunlar için Root Cause Analizi**

Yapılan derin analize göre, son 6 ayda tekrarlanan mekanik montaj sorunlarının temel nedenleri:

**5 Neden (5 Why) Analizi:**

1. **Neden bara bağlantılarında gevşeme oluyor?** 
   → Çünkü cıvata sıkma torkları standarda uygun değil

2. **Neden torklama standarda uygun değil?** 
   → Çünkü kalibrasyonu yapılmamış el aletleri kullanılıyor

3. **Neden kalibrasyonu yapılmamış aletler kullanılıyor?** 
   → Çünkü kalibrasyon takip sistemi etkin işlemiyor

4. **Neden kalibrasyon takibi etkin yapılmıyor?** 
   → Çünkü kalibrasyon sorumluluğu net tanımlanmamış

5. **Neden sorumluluklar net tanımlanmamış?** 
   → Çünkü prosedürde güncelleme yapılmamış ve eğitim verilmemiş

**Temel Sebep (Root Cause):** Prosedür güncellemesi ve eğitim eksikliği

**Çözüm Önerileri:**
1. Kalibrasyon prosedürünün güncellenmesi ve sorumlulukların net belirlenmesi
2. Montaj çalışanlarına tork değerleri ve kalibrasyon önemi eğitimi
3. Bağlantı tork değerlerinin iş emirlerinde standart olarak belirtilmesi
4. Dijital torkmetre ile doğrulama ve kayıt sistemi oluşturulması
5. Periyodik kalibrasyon programının otomatik hatırlatma sistemine bağlanması`;
            }
            
            if (userMessageLower.includes('kalite sorun') || userMessageLower.includes('tekrarlayan')) {
                return `**Tekrarlayan Kalite Sorunlarını Azaltma Stratejisi**

Kalite verilerinizin derin analizi ve sektör en iyi uygulamaları doğrultusunda:

**Mevcut Durum Analizi:**
- Son 3 ayda tekrarlayan kalite sorunlarının %65'i elektriksel bağlantı hataları
- %22'si mekanik montaj uyumsuzluğu
- %13'ü test prosedürü eksikliği

**Temel Nedenler (Pareto Analizi):**
1. Operatör değişkenliği ve dokümantasyon eksikliği (%42)
2. İş talimatlarının yetersizliği veya güncel olmaması (%27)
3. Kalite kontrol noktalarının yetersizliği (%18)
4. Ekipman ve ölçüm aletleri sorunları (%13)

**İyileştirme Stratejisi:**

1. **İş Standardizasyonu ve Dokümantasyon**
   - Kritik montaj adımları için görsel iş talimatları
   - Elektronik iş takip sistemi (tablet destekli)
   - Kritik nokta kontrollerinin (checkpoint) artırılması

2. **Eğitim ve Yetkinlik**
   - Operatörlere teknik bağlantı eğitimleri (hands-on)
   - Kalite bilinci eğitimi
   - Hata önleyici teknikler (Poka-Yoke) eğitimi

3. **Süreç İzleme ve Kontrol**
   - Kritik parametreler için istatistiksel süreç kontrolü (SPC)
   - Gerçek zamanlı kalite takip panelleri
   - Günlük kalite koordinasyon toplantıları

4. **Sürekli İyileştirme Sistemi**
   - Kalite çemberleri oluşturulması
   - Düzeltici ve önleyici faaliyet sistemi revizyonu
   - Aylık trend analizi ve iyileştirme projelerinin başlatılması

Bu stratejinin 3 aylık bir sürede hata oranını %65 azaltması öngörülmektedir.`;
            }
            
            // Genel uzman cevabı
            return `**Teknik Uzmanlık Değerlendirme**

İlettiğiniz konu hakkında detaylı teknik analiz yapmam için daha spesifik bilgilere ihtiyacım var. Uzmanlık modunda aşağıdaki alanlarda detaylı teknik destek sağlayabilirim:

- Ekipman arıza analizleri ve root cause değerlendirmesi
- Üretim süreçlerinde ileri optimizasyon
- Teknik sorunlarda ileri problem çözme metodolojileri
- Kalite iyileştirme ve hata önleme sistemleri
- Teknik uygulama ve tasarım optimizasyonu

Lütfen analiz etmemi istediğiniz teknik konuyu detaylandırır mısınız? Ekipman modelini, gözlemlenen belirtileri ve yapılan müdahaleleri paylaşırsanız daha etkili bir analiz sunabilirim.`;
        }

        // Konuşmayı LocalStorage'a kaydet
        function saveConversationToStorage() {
            // Mevcut oturumu al
            const currentSession = aiAssistant.currentSession;
            
            // Önceki oturumları yükle
            let conversations = JSON.parse(localStorage.getItem('metsAiConversations') || '[]');
            
            // Mevcut oturum daha önce kaydedilmiş mi kontrol et
            const existingIndex = conversations.findIndex(s => s.id === currentSession.id);
            if (existingIndex !== -1) {
                // Varolan oturumu güncelle
                conversations[existingIndex] = currentSession;
            } else {
                // Yeni oturumu ekle
                conversations.push(currentSession);
            }
            
            // Son 20 konuşmayı tut
            if (conversations.length > 20) {
                conversations = conversations.slice(-20);
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem('metsAiConversations', JSON.stringify(conversations));
        }

        // Markdown tablosunu HTML'e dönüştür
        function convertMarkdownTableToHTML(markdown) {
            const tableRegex = /\|(.+)\|[\r\n]\|([-:\s|]+)\|[\r\n]((?:\|.+\|[\r\n])+)/g;
            const rowRegex = /\|(.+)\|[\r\n]/g;
            
            return markdown.replace(tableRegex, function(match, headerRow, separatorRow, bodyRows) {
                // Başlık sütunlarını ayır
                const headers = headerRow.split('|').map(h => h.trim());
                
                // HTML tablo başlığı oluştur
                let tableHtml = '<table class="table table-bordered table-sm">\n<thead>\n<tr>\n';
                
                // Başlık hücreleri ekle
                headers.forEach(header => {
                    tableHtml += `<th>${header}</th>\n`;
                });
                
                tableHtml += '</tr>\n</thead>\n<tbody>\n';
                
                // Gövde satırlarını işle
                let rowMatch;
                while ((rowMatch = rowRegex.exec(bodyRows)) !== null) {
                    const rowContent = rowMatch[1];
                    const cells = rowContent.split('|').map(c => c.trim());
                    
                    tableHtml += '<tr>\n';
                    cells.forEach(cell => {
                        tableHtml += `<td>${cell}</td>\n`;
                    });
                    tableHtml += '</tr>\n';
                }
                
                tableHtml += '</tbody>\n</table>';
                
                return tableHtml;
            });
        }

        // Aksiyon butonlarını ekle
        function addActionButtons(message) {
            // Rapor butonu
            if (message.includes('[Rapor Oluştur](report)')) {
                message = message.replace(/\[Rapor Oluştur\]\(report\)/g, 
                    '<button class="btn btn-sm btn-warning ms-2 report-action-btn"><i class="bi bi-file-earmark-text"></i> Rapor Oluştur</button>');
            }
            
            // Tahmin butonu
            if (message.includes('[Tahmin Göster](prediction)')) {
                message = message.replace(/\[Tahmin Göster\]\(prediction\)/g, 
                    '<button class="btn btn-sm btn-success ms-2 prediction-action-btn"><i class="bi bi-graph-up-arrow"></i> Tahmin Göster</button>');
            }
            
            return message;
        }

        // Tarih formatlama
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        // Sistem verilerini yükle
        async function loadSystemData() {
            // Gerçek bir API'den veri çekilecek, burada mock veri kullanıyoruz
            aiAssistant.systemTrainingData = {
                orders: [
                    { id: '#0424-1233', status: 'testing', desc: 'RM 36 CB hücresi', delay: 0 },
                    { id: '#0424-1245', status: 'assembly', desc: 'RMU hücresi', delay: 0 },
                    { id: '#0424-1251', status: 'waiting_material', desc: 'Kompakt Hücre', delay: 7 },
                    { id: '#0424-1260', status: 'design', desc: 'Metal Clad Hücre', delay: 0 },
                    { id: '#0424-1272', status: 'started', desc: 'KOF Hücresi', delay: 0 }
                ],
                materials: [
                    { id: 'M001', name: 'Siemens rölesi', stock: 2, required: 8, critical: true },
                    { id: 'M002', name: 'KAP-80/190-95 Akım Trafosu', stock: 3, required: 5, critical: true },
                    { id: 'M003', name: 'M480TB/G-027-95.300UN5 Kablo Başlığı', stock: 12, required: 15, critical: false }
                ],
                tasks: [
                    { id: 'T001', desc: 'Elektriksel test', orderId: '#0424-1233', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T002', desc: 'Kablo bağlantıları', orderId: '#0424-1245', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T003', desc: 'Tedarikçi görüşmeleri', orderId: '#0424-1251', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T004', desc: 'Üretim toplantısı', orderId: '', dueDate: '2023-11-08', status: 'scheduled' },
                    { id: 'T005', desc: 'Kalite kontrol raporu', orderId: '', dueDate: '2023-11-08', status: 'scheduled' }
                ]
            };
            
            return true;
        }

        // Tahmin modellerini başlat 
        function initPredictionModels() {
            aiAssistant.predictionModels = {
                deliveryPrediction: {
                    initialized: true,
                    version: "1.0"
                }
            };
            return true;
        }

        // Öğrenme verisi toplama
        function gatherLearningData() {
            // Sayfa içeriğinden basic veri toplama
            const pageContent = document.body.innerText;
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5');
            const headingTexts = Array.from(headings).map(h => h.textContent);
            
            aiAssistant.learningData.push({
                type: "page_content",
                data: {
                    headings: headingTexts,
                    timestamp: new Date().toISOString()
                }
            });
            
            return true;
        }

        // Etkileşimlerden öğrenme
        function learnFromInteraction(userMessage, aiResponse) {
            // Kullanıcı ve AI mesajlarından öğrenme verisi toplama
            aiAssistant.learningData.push({
                type: "interaction",
                data: {
                    userMessage: userMessage,
                    aiResponse: aiResponse,
                    timestamp: new Date().toISOString()
                }
            });
            
            return true;
        }

        // Teslimat tahmin grafiği oluştur
        function renderDeliveryPredictionChart() {
            const ctx = document.getElementById('deliveryPredictionChart');
            if (!ctx) return;
            
            // Mevcut bir grafik varsa temizle
            if (window.deliveryChart) {
                window.deliveryChart.destroy();
            }
            
            // Grafik verisini hazırla
            const data = {
                labels: ['#0424-1233', '#0424-1245', '#0424-1251', '#0424-1260', '#0424-1272'],
                datasets: [
                    {
                        label: 'Planlanan Teslimat',
                        data: [12, 19, 22, 28, 35],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        type: 'line'
                    },
                    {
                        label: 'Tahmin Edilen Teslimat',
                        data: [12, 19, 30, 31, 38],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        type: 'line', 
                        borderDash: [5, 5]
                    },
                    {
                        label: 'Gerekli Üretim Süresi',
                        data: [10, 15, 18, 22, 28],
                        backgroundColor: 'rgba(46, 204, 113, 0.6)',
                        type: 'bar'
                    }
                ]
            };
            
            // Grafik oluştur
            window.deliveryChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Gün'
                            },
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Sipariş No'
                            }
                        }
                    }
                }
            });
        }

        // Rapor için grafik oluştur
        function renderReportCharts(reportData) {
            // Task Completion Chart
            if (reportData.charts.taskCompletion) {
                const ctx = document.getElementById('reportTaskCompletionChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: reportData.charts.taskCompletion.labels,
                            datasets: reportData.charts.taskCompletion.datasets.map(dataset => ({
                                label: dataset.label,
                                data: dataset.data,
                                borderColor: dataset.borderColor,
                                backgroundColor: dataset.borderColor + '20',
                                tension: 0.3,
                                fill: true
                            }))
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }
            
            // Delay Reasons Chart
            if (reportData.charts.delayReasons) {
                const ctx = document.getElementById('reportDelayReasonsChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: reportData.charts.delayReasons.labels,
                            datasets: [{
                                data: reportData.charts.delayReasons.data,
                                backgroundColor: [
                                    '#e74c3c',
                                    '#3498db',
                                    '#f1c40f',
                                    '#9b59b6',
                                    '#2ecc71'
                                ]
                            }]
                        }
                    });
                }
            }
        }
        
        // Rapor için veri hazırla
        function prepareReportData(type, startDate, endDate, departments, focus, customCriteria) {
            // Gerçek uygulamada API'den veri çekilecek
            // Bu demo için statik veri hazırlayalım
            
            let reportData = {
                title: "",
                date: new Date().toLocaleDateString('tr-TR'),
                dateRange: `${formatDate(startDate)} - ${formatDate(endDate)}`,
                departments: departments.includes('all') ? 'Tüm Birimler' : departments.join(', '),
                summary: "",
                sections: [],
                metrics: {},
                charts: {},
                highlights: []
            };
            
            // Rapor türüne göre içerik oluştur
            switch (type) {
                case 'daily':
                    reportData.title = `Günlük Durum Raporu (${formatDate(endDate)})`;
                    reportData.summary = "Bu rapor, bugünkü üretim durumu, tamamlanan görevler, sorunlar ve aksiyonları içermektedir.";
                    reportData.sections = [
                        {
                            title: "Üretim Özeti",
                            content: "Bugün 5 sipariş üzerinde çalışıldı, 2 sipariş tamamlandı. Toplam 18 görev planlandı, 15 görev tamamlandı."
                        },
                        {
                            title: "Kritik Durumlar",
                            content: "1 siparişte malzeme tedariki kaynaklı gecikme yaşanıyor (#0424-1251). Satın alma birimi alternatif tedarikçi araştırması yapıyor."
                        },
                        {
                            title: "Tamamlanan İşler",
                            content: "- RM 36 CB hücresi elektriksel testleri tamamlandı (#0424-1233)\n- Mekanik montaj işlemleri tamamlandı (#0424-1245)\n- Kablo başlığı montajı tamamlandı (#0424-1239)"
                        }
                    ];
                    reportData.metrics = {
                        planCompletion: 83,
                        delayedTasks: 2,
                        completedOrders: 2,
                        materialShortages: 1
                    };
                    reportData.highlights = [
                        "Üretim planı %83 oranında gerçekleştirildi",
                        "2 görevde gecikme var, satın alma sürecinden kaynaklı",
                        "3 hücrenin montajı tamamlandı ve teste hazır"
                    ];
                    break;
                    
                case 'weekly':
                    reportData.title = "Haftalık İlerleme Raporu";
                    // Rapor içeriği oluşturulacak
                    break;
                    
                case 'meeting':
                    reportData.title = "Toplantı Özeti ve Aksiyon Noktaları";
                    // Rapor içeriği oluşturulacak
                    break;
                    
                // Diğer rapor tipleri...
            }
            
            // Odak alanına göre ek bilgiler ekle
            if (focus === 'delays') {
                reportData.sections.push({
                    title: "Gecikme Analizi",
                    content: "Son 7 günde yaşanan gecikmelerin ana nedeni malzeme tedarikindeki aksamalar (%45) ve test sürecindeki teknik sorunlar (%30). Özellikle akım trafosu tedariğinde yaşanan gecikmeler kritik öneme sahip."
                });
            } else if (focus === 'materials') {
                reportData.sections.push({
                    title: "Malzeme Durumu",
                    content: "Kritik stok seviyesindeki malzemeler: Siemens rölesi (2 adet, 8 adet ihtiyaç), KAP-80/190-95 Akım Trafosu (3 adet, 5 adet ihtiyaç). Son 7 günde 4 acil malzeme siparişi verildi."
                });
            }
            
            // Özel kriterler varsa ekle
            if (customCriteria) {
                reportData.sections.push({
                    title: "Özel Analiz",
                    content: `Talep ettiğiniz "${customCriteria}" konusu hakkında yapılan analiz sonuçları: [Burada detaylı analiz sonuçları yer alacak]`
                });
            }
            
            // Grafik verileri ekle
            reportData.charts = {
                taskCompletion: {
                    labels: ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma'],
                    datasets: [
                        {
                            label: 'Planlanan',
                            data: [12, 15, 10, 8, 18],
                            borderColor: '#3498db'
                        },
                        {
                            label: 'Tamamlanan',
                            data: [10, 13, 8, 6, 15],
                            borderColor: '#2ecc71'
                        }
                    ]
                },
                delayReasons: {
                    labels: ['Malzeme Tedariki', 'Teknik Sorunlar', 'Personel Eksikliği', 'Test Sorunları', 'Diğer'],
                    data: [45, 30, 10, 10, 5]
                }
            };
            
            return reportData;
        }

        // Rapor HTML içeriği oluşturma
        function generateReportHTML(reportData, includeCharts) {
            let html = `
                <div class="report-header text-center mb-4">
                    <h3>${reportData.title}</h3>
                    <p class="text-muted">${reportData.dateRange} | ${reportData.departments}</p>
                    <hr>
                </div>
                
                <div class="report-summary mb-4">
                    <h5>Özet</h5>
                    <p>${reportData.summary}</p>
                </div>
                
                <div class="report-metrics mb-4">
                    <div class="row">
                    ${reportData.metrics.planCompletion !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Plan Tamamlama</h6>
                                    <h3 class="card-text">${reportData.metrics.planCompletion}%</h3>
                                </div>
                            </div>
                        </div>` : ''}
                    
                    ${reportData.metrics.delayedTasks !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Geciken İşler</h6>
                                    <h3 class="card-text">${reportData.metrics.delayedTasks}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                        
                    ${reportData.metrics.completedOrders !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Tamamlanan Siparişler</h6>
                                    <h3 class="card-text">${reportData.metrics.completedOrders}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                        
                    ${reportData.metrics.materialShortages !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Malzeme Eksiklikleri</h6>
                                    <h3 class="card-text">${reportData.metrics.materialShortages}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                    </div>
                </div>
            `;
            
            // Grafikleri ekle
            if (includeCharts && Object.keys(reportData.charts).length > 0) {
                html += `
                    <div class="report-charts mb-4">
                        <div class="row">
                            ${reportData.charts.taskCompletion ? `
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header">Görev Tamamlama</div>
                                    <div class="card-body">
                                        <canvas id="reportTaskCompletionChart"></canvas>
                                    </div>
                                </div>
                            </div>` : ''}
                            
                            ${reportData.charts.delayReasons ? `
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header">Gecikme Nedenleri (%)</div>
                                    <div class="card-body">
                                        <canvas id="reportDelayReasonsChart"></canvas>
                                    </div>
                                </div>
                            </div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Bölümleri ekle
            html += `<div class="report-sections">`;
            reportData.sections.forEach(section => {
                html += `
                    <div class="report-section mb-4">
                        <h5>${section.title}</h5>
                        <div class="card">
                            <div class="card-body">
                                ${section.content.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            
            // Rapor altbilgisi
            html += `
                <div class="report-footer text-center mt-4 pt-3 border-top">
                    <p class="small text-muted">Bu rapor METS Yapay Zeka Asistanı tarafından ${reportData.date} tarihinde otomatik olarak oluşturulmuştur.</p>
                </div>
            `;
            
            return html;
        }

        // Bildirim göster
        function showNetworkStatusNotification(message, type = 'info') {
            // Toast bildirim gösterimi
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast, {
                delay: 3000
            });
            bsToast.show();
            
            // Otomatik kaldır
            setTimeout(() => {
                if (toastContainer.contains(toast)) {
                    toastContainer.removeChild(toast);
                }
            }, 3500);
        }

        // Eğitim verilerini yükle
        function loadTrainingData() {
            // Gerçek uygulamada API'den yüklenecek
            // Demo için temel verileri manuel ekle
            aiAssistant.systemTrainingData = {
                // Temel eğitim verileri
                basics: {
                    companyInfo: "METS - Mehmet Endüstriyel Takip Sistemi, Endüstriyel üretim takibi, malzeme yönetimi ve üretim optimizasyonu çözümleri sunan bir sistemdir.",
                    products: ["Orta Gerilim Hücreleri", "Alçak Gerilim Panoları", "Reaktif Güç Kompanzasyon Sistemleri", "Özel Tasarım Elektrik Dağıtım Sistemleri"]
                }
            };
            
            return true;
        }
    </script>

    <!-- Yapay Zeka JS Functions -->
    <script>
        // Hoşgeldiniz mesajı
        function getWelcomeMessage() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) {
                greeting = "Günaydın";
            } else if (hour < 18) {
                greeting = "İyi günler";
            } else {
                greeting = "İyi akşamlar";
            }
            
            return `${greeting}! Ben METS Yapay Zeka Asistanınızım. Üretim takibi, malzeme yönetimi, raporlama ve analiz konularında yardımcı olabilirim. Farklı modları kullanarak spesifik ihtiyaçlarınıza yönelik hizmet alabilirsiziniz. Nasıl yardımcı olabilirim?`;
        }

        // AI mesajını formatla ve ekrana yazdır
        function displayAIMessage(message, scrollToBottom = true) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message ai-message mb-3';
            
            // Markdown benzeri formatlama desteği
            let formattedMessage = message
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            // URL'leri bağlantıya dönüştür
            formattedMessage = formattedMessage.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>');
            
            // Aksiyon butonları ekleme
            if (message.includes('[Rapor Oluştur]')) {
                formattedMessage = formattedMessage.replace(/\[Rapor Oluştur\]\(report\)/g, 
                    '<button class="btn btn-sm btn-warning ms-2 report-action-btn"><i class="bi bi-file-earmark-text"></i> Rapor Oluştur</button>');
            }
            
            if (message.includes('[Tahmin Göster]')) {
                formattedMessage = formattedMessage.replace(/\[Tahmin Göster\]\(prediction\)/g, 
                    '<button class="btn btn-sm btn-success ms-2 prediction-action-btn"><i class="bi bi-graph-up-arrow"></i> Tahmin Göster</button>');
            }
            
            messageElement.innerHTML = formattedMessage;
            messagesContainer.appendChild(messageElement);
            
            // Buton işlevselliklerini ekle
            if (message.includes('[Rapor Oluştur]')) {
                const reportBtn = messageElement.querySelector('.report-action-btn');
                if (reportBtn) {
                    reportBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showReportModal();
                    });
                }
            }
            
            if (message.includes('[Tahmin Göster]')) {
                const predictionBtn = messageElement.querySelector('.prediction-action-btn');
                if (predictionBtn) {
                    predictionBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        showPredictionModal();
                    });
                }
            }
            
            if (scrollToBottom) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Kullanıcı mesajını ekrana yazdır
        function displayUserMessage(message) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message user-message mb-3';
            
            // Mesajı HTML güvenli hale getir
            const safeMessage = message
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            
            messageElement.innerHTML = safeMessage;
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Mod değiştirme mesajı
        function getModeSwitchMessage(mode) {
            const modeSwitchMessages = {
                'assistant': "Asistan moduna geçtim. Size günlük işlerinizde yardımcı olacağım. Sipariş durumları, malzeme takibi veya üretim bilgileri hakkında sorular sorabilirsiniz.",
                'analyst': "Analiz moduna geçtim. Bu modda üretim verileri, performans metrikleri ve verimlilik analizleri hakkında derinlemesine analizler sunabilirim.",
                'reporter': "Rapor moduna geçtim. Toplantılar, üretim durumu ve performans hakkında özetler ve raporlar oluşturabilirim. [Rapor Oluştur](report) butonuna tıklayarak detaylı rapor hazırlayabilirim.",
                'predictor': "Tahmin moduna geçtim. Üretim gecikmeleri, kaynak ihtiyaçları ve potansiyel darboğazlar için öngörüler ve çözüm önerileri sunacağım. [Tahmin Göster](prediction) butonuyla detaylı analiz görebilirsiniz.",
                'expert': "Uzman moduna geçtim. Bu modda teknik sorunlara, optimizasyon önerilerine ve ileri seviye çözümlere odaklanacağım. Karmaşık üretim sorunları hakkında sorular sorabilirsiniz."
            };
            
            return modeSwitchMessages[mode] || "Mod değiştirildi. Size nasıl yardımcı olabilirim?";
        }

        // Asistan modu cevap oluşturma
        function generateAssistantResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            // Basit anahtar kelime kontrolü
            if (userMessageLower.includes('merhaba') || userMessageLower.includes('selam') || userMessageLower.includes('nasıl')) {
                return "Merhaba! Size nasıl yardımcı olabilirim?";
            }
            
            if (userMessageLower.includes('sipariş') || userMessageLower.includes('durum')) {
                return `Mevcut siparişlerin durumu şu şekilde:
                
1. #0424-1233: Üretim tamamlandı, test aşamasında
2. #0424-1245: Mekanik montaj tamamlandı, elektrik testinde
3. #0424-1251: Malzeme bekleniyor, 3 gün gecikme var
4. #0424-1260: Tasarım aşamasında, zamanında ilerliyor
5. #0424-1272: Yeni başladı, malzeme tedariği yapılıyor

Daha detaylı bilgi için hangi sipariş hakkında bilgi almak istersiniz?`;
            }
            
            if (userMessageLower.includes('malzeme') || userMessageLower.includes('stok')) {
                return `Kritik stok seviyesindeki malzemeler:
                
- Siemens rölesi (2 adet, 8 adet ihtiyaç)
- KAP-80/190-95 Akım Trafosu (3 adet, 5 adet ihtiyaç)
- M480TB/G-027-95.300UN5 Kablo Başlığı (12 adet, 15 adet ihtiyaç)

Bu malzemelerin tedariki için satın alma departmanıyla görüşme başlatıldı. Alternatif tedarikçiler araştırılıyor.`;
            }
            
            if (userMessageLower.includes('gecikme') || userMessageLower.includes('risk')) {
                return `Teslimat gecikme riski olan siparişler:
                
1. #0424-1251: Akım trafosu tedarik gecikmesi (1 hafta)
2. #0424-1260: Tasarım revizyonu gerekebilir (potansiyel 3-5 gün)

Gecikmeleri önlemek için aşağıdaki aksiyonlar alındı:
- Alternatif tedarikçi araştırması
- Ek mesai planlaması
- Öncelik sıralaması güncellendi`;
            }
            
            if (userMessageLower.includes('görev') || userMessageLower.includes('bugün')) {
                return `Bugün tamamlanması planlanan görevler:
                
1. #0424-1233 sipariş için elektriksel testlerin bitirilmesi
2. #0424-1245 için kablo bağlantı işlemlerinin tamamlanması
3. #0424-1251 için alternatif tedarikçi görüşmeleri
4. Haftalık üretim toplantısı (14:00)
5. Kalite kontrol raporunun hazırlanması

Bu görevlerden hangisi hakkında daha detaylı bilgi almak istersiniz?`;
            }
            
            // Genel cevap
            return `Üretim takip sistemindeki verilere göre şu anki durum şöyle:

- Aktif 5 üretim siparişi mevcut
- 2 sipariş teslimat aşamasında
- 1 siparişte tedarik kaynaklı gecikme söz konusu
- Kalite kontrol testlerinde bugün 3 ürün onaylandı

Daha detaylı bilgi için sipariş durumları, malzeme stokları veya üretim planı hakkında sorular sorabilirsiniz.`;
        }

        // Analist modu cevap oluşturma
        function generateAnalysisResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('verimlilik') || userMessageLower.includes('performans')) {
                return `**Son 30 Günün Verimlilik Analizi**

| Birim | Plan Gerçekleşme | Gecikme | Kalite Skoru |
|-------|------------------|---------|--------------|
| Mekanik Üretim | %92 | 3 gün | 4.7/5 |
| Elektrik Montaj | %87 | 5 gün | 4.5/5 |
| Kablaj | %96 | 1 gün | 4.8/5 |
| Test | %84 | 4 gün | 4.6/5 |

En büyük gecikme kaynaklarımız:
1. Malzeme tedarik süreçleri (%45)
2. Tasarım revizyonları (%30)
3. Test süreçleri (%15)
4. Diğer (%10)

Verimliliği artırmak için önerilen aksiyonlar:
- Tedarik zinciri optimizasyonu
- Test süreçlerinin otomasyonu
- Birimler arası koordinasyonun artırılması`;
            }
            
            if (userMessageLower.includes('gecikme') || userMessageLower.includes('sebep')) {
                return `**Gecikme Sebepleri Analizi**

Gecikmelerin ana nedenleri (son 3 ay verilerine göre):

1. **Malzeme Tedariki (45%)**
   - Akım trafosu tedarikindeki gecikmeler
   - Siemens röle tedariğindeki gecikmeler
   - Global tedarik zincirindeki sorunlar

2. **Tasarım Değişiklikleri (25%)**
   - Müşteri talepleri kaynaklı revizyonlar
   - Uyumluluk sorunları nedeniyle revizyonlar

3. **Üretim Kapasitesi Sorunları (15%)**
   - Mekanik üretim darboğazları
   - Kalifiye personel eksikliği

4. **Test Süreçleri (10%)**
   - Tekrarlanan hatalar
   - Test ekipmanı yetersizliği

5. **Diğer (5%)**

**İyileştirme Önerileri:**
- Alternatif tedarikçi havuzu oluşturulması
- Tasarım onay süreçlerinin iyileştirilmesi
- Üretim kapasitesinin artırılması`;
            }
            
            if (userMessageLower.includes('iş transfer') || userMessageLower.includes('birim')) {
                return `**Birimler Arası İş Transferinde Sorun Yaşanan Noktalar**

Son 60 günlük veri analizi sonuçları:

1. **Tasarım → Üretim Transferi**
   - Tasarım dokümanlarındaki eksiklikler
   - Revizyon kontrollerindeki hatalar
   - Teknik detay eksiklikleri

2. **Mekanik Üretim → Elektrik Montaj**
   - Fiziksel uyumsuzluklar
   - Standartlarda farklı yorumlar
   - Dokümantasyon eksiklikleri

3. **Montaj → Test**
   - Test öncesi kontrollerin eksikliği
   - Hata bildirimlerinin standart olmaması

**Önerilen İyileştirmeler:**
- Birimler arası dijital iş takip sisteminin iyileştirilmesi
- Standart transfer kontrol listelerinin güncellenmesi
- Önemli nokta kontrollerinin arttırılması
- Ekipler arası düzenli koordinasyon toplantıları`;
            }
            
            // Genel analiz cevabı
            return `**Üretim Analiz Raporu**

Son 30 günlük veriler analiz edildiğinde:

- Üretim verimliliği: %85 (geçen aya göre %3 artış)
- Ortalama teslimat gecikme süresi: 4.2 gün (geçen aya göre 0.8 gün azalma)
- Kalite red oranı: %3.1 (geçen aya göre %0.7 iyileşme)
- Malzeme tedarik performansı: %78 (geçen aya göre %5 azalma)

**Kritik Noktalar:**
- Mekanik üretimde verimlilik artışı sağlandı
- Elektrik montajda kalite sorunları azaldı
- Malzeme tedarikinde yaşanan sorunlar üretimdeki en büyük gecikme sebebi

Daha detaylı analiz için lütfen spesifik bir alan veya dönem belirtiniz.`;
        }

        // Rapor modu cevap oluşturma
        function generateReporterResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('üretim durum') || userMessageLower.includes('özetle')) {
                return `**Günlük Üretim Durumu Özeti**

Bugünkü üretim durumu ile ilgili genel özet:

- Aktif sipariş sayısı: 8
- Planlanan görev sayısı: 24
- Tamamlanan görev sayısı: 18
- Plan gerçekleşme oranı: %75

**Kritik durumlar:**
- #0424-1251 siparişinde malzeme tedarik gecikmesi (1 hafta)
- Mekanik üretimde kapasite sorunu (%110 yük)
- Test laboratuvarında 2 hücre testi bekliyor

Size daha detaylı bir rapor hazırlayabilirim. [Rapor Oluştur](report) butonuna tıklayarak özelleştirilmiş rapor oluşturabilirsiniz.`;
            }
            
            if (userMessageLower.includes('performans özet') || userMessageLower.includes('haftalık')) {
                return `**Haftalık Performans Özeti**

Geçen haftanın üretim performansı analizi:

- Tamamlanan sipariş sayısı: 3
- Başlayan yeni sipariş sayısı: 2
- Ortalama sipariş tamamlama süresi: 18 gün
- Kalite uygunsuzluğu tespit edilen ürün sayısı: 2
- Kalite düzeltme için harcanan toplam süre: 16 saat

**Başarılı Alanlar:**
- Mekanik üretim hedefin %5 üzerinde performans gösterdi
- Test süreleri ortalama 1.5 gün azaldı

**İyileştirme Gereken Alanlar:**
- Malzeme tedarik süreçlerinin iyileştirilmesi
- Tasarım revizyonlarının azaltılması

Detaylı haftalık rapor için [Rapor Oluştur](report) butonuna tıklayabilirsiniz.`;
            }
            
            if (userMessageLower.includes('toplantı') || userMessageLower.includes('yönetim')) {
                return `**Yönetim Toplantısı için Özet Rapor**

Toplantıda sunulmak üzere hazırlanmış özet:

**Üretim:**
- 8 aktif sipariş, 3 tamamlanma aşamasında
- Kapasite kullanımı: %92
- Kritik gecikme riski: 1 sipariş (#0424-1251)

**Kalite:**
- Kalite red oranı: %2.8
- Tekrarlayan sorun: Kablo bağlantı hataları

**Finans:**
- Malzeme maliyet sapması: +%3.5
- İş gücü maliyet sapması: -%1.2

**Alınması Gereken Aksiyonlar:**
1. Akım trafosu tedarikçi alternatifi belirlenmesi
2. Kablo bağlantılarında kalite kontrol artırımı
3. Mekanik üretim kapasitesinin değerlendirilmesi

Tam rapor için [Rapor Oluştur](report) butonunu kullanabilirsiniz.`;
            }
            
            // Genel rapor cevabı
            return `Size kapsamlı bir rapor hazırlayabilirim. Rapor türünü ve içeriğini belirlemek için [Rapor Oluştur](report) butonuna tıklayabilir veya aşağıdaki seçeneklerden biriyle ilgili sorabilirsiniz:

1. Günlük üretim durumu özeti
2. Haftalık performans raporu
3. Malzeme durum raporu
4. Yönetim toplantısı özeti
5. Kalite kontrol raporu

Hangisi hakkında bilgi almak istersiniz?`;
        }

        // Tahmin modu cevap oluşturma
        function generatePredictionResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('üretim kapasite') || userMessageLower.includes('yeterli')) {
                return `**Üretim Kapasite Tahmini (Önümüzdeki 30 gün)**

Yapay zeka modelim mevcut üretim planı, tarihsel veriler ve kapasite bilgilerine göre analiz yaptı.

**Özet Tahmin:**
Önümüzdeki ay için mevcut kapasiteniz %92 oranında dolacak. Öngörülen sipariş artışları ile birlikte 3. haftada kapasite aşımı riski bulunmaktadır.

**Birim Bazlı Tahminler:**
- Mekanik Üretim: %105 (Kapasite Aşımı!)
- Elektrik Montaj: %85
- Kablaj: %78
- Test: %95

**Potansiyel Darboğazlar:**
- 15-20 Kasım tarihleri arasında mekanik üretimde kapasite aşımı
- 22-25 Kasım tarihleri arasında test biriminde yoğunluk

**Öneriler:**
1. Mekanik üretim için ek vardiya planlaması
2. Test işlemleri için önceliklendirme
3. Yoğun dönem için ekstra kaynak planlaması

Daha detaylı analiz için [Tahmin Göster](prediction) butonuna tıklayabilirsiniz.`;
            }
            
            if (userMessageLower.includes('teslimat gecikme') || userMessageLower.includes('gecikme risk')) {
                return `**Teslimat Gecikme Riski Tahmini**

Mevcut üretim verilerine göre yapılan analiz sonucunda:

**Yüksek Gecikme Riski Olan Siparişler:**
1. #0424-1251: %85 gecikme riski (ortalama 7-10 gün)
   *Sebep: Akım trafosu tedarik gecikmesi*
   
2. #0424-1260: %60 gecikme riski (ortalama 3-5 gün)
   *Sebep: Tasarım revizyonları ve mekanik üretim yoğunluğu*

**Orta Dereceli Gecikme Riski:**
3. #0424-1270: %40 gecikme riski (ortalama 2-4 gün)
   *Sebep: Test süreçlerindeki olası gecikmeler*

**Risk Azaltma Önerileri:**
- #0424-1251 için alternatif tedarikçi kullanımı (%85 risk → %40 risk)
- #0424-1260 için tasarım ekibiyle acil değerlendirme toplantısı
- Kritik siparişler için kaynak önceliklendirmesi

Detaylı tahmin analizi için [Tahmin Göster](prediction) butonunu kullanabilirsiniz.`;
            }
            
            if (userMessageLower.includes('malzeme tedarik') || userMessageLower.includes('stok sorun')) {
                return `**Malzeme Tedarik Risk Tahmini (Önümüzdeki 14 gün)**

Tedarik zinciri ve stok verileri analiz edildiğinde:

**Kritik Risk Noktaları:**
1. Akım trafosu (KAP-80/190-95): Stok 3 adet, İhtiyaç 8 adet
   *Tahmin: 10 gün içinde üretim duruşuna sebep olabilir*
   
2. Siemens koruma rölesi: Stok 2 adet, İhtiyaç 5 adet
   *Tahmin: 7 gün içinde kritik stok seviyesi*

3. Kablo başlığı (Raychem): Stok 6 adet, İhtiyaç 12 adet
   *Tahmin: 12 gün içinde kritik stok seviyesi*

**Tahmin Modeli Önerileri:**
- Akım trafoları için express teslimat seçeneği değerlendirilmeli
- Alternatif tedarikçilerle acil tedarik görüşmesi
- Bazı siparişlerde malzeme değişikliği (teknik açıdan uygun olanlarda)

Tüm tahmin analizini görmek için [Tahmin Göster](prediction) butonunu kullanabilirsiniz.`;
            }
            
            // Genel tahmin cevabı
            return `**Üretim ve Tedarik Tahmin Analizi**

Yapay zeka tahmin modelim, mevcut veriler ve tarihsel trendleri analiz ederek aşağıdaki tahminleri üretiyor:

**Üretim Tahminleri (30 gün):**
- Toplam üretim kapasitesi kullanımı: %92 (kritik seviye)
- Darboğaz riski: 15-20 Kasım tarihleri arasında mekanik üretim
- Tamamlanması öngörülen sipariş: 6 adet

**Tedarik Tahminleri:**
- Malzeme tedarik gecikme riski: 3 kritik kalem
- Stok yetersizliği riski: %40

**Teslimat Tahminleri:**
- Zamanında teslimat oranı: %80
- Gecikme riski yüksek siparişler: 2 adet

Detaylı tahmin analizleri ve senaryoları için [Tahmin Göster](prediction) butonuna tıklayabilirsiniz.`;
        }

        // Uzman modu cevap oluşturma
        function generateExpertResponse(userMessage) {
            const userMessageLower = userMessage.toLowerCase();
            
            if (userMessageLower.includes('rm 36') || userMessageLower.includes('arıza')) {
                return `**RM 36 CB Hücresindeki Arıza Analizi**

Arıza veri analizi ve benzer vakalardan öğrendiğim bilgilere göre:

**Olası Nedenler (Olasılık sırasıyla):**
1. **Mekanik Kilitleme Mekanizması (72%)**
   - Kilitleme yayında yorulma
   - Hareket mekanizmasında hizalama sorunu
   - Montaj sırasında tolerans dışı durumlar

2. **Kontrol Devresinde Sorun (18%)**
   - Yardımcı kontak arızası
   - Kontrol kablolamasında oksitlenme/kopukluk
   - Motor sürücü devre arızası

3. **Anahtarlama Mekanizması (6%)**
   - Vakum tüplerde aşınma
   - Kontaklarda yanma/aşınma

4. **Diğer (4%)**
   - PCB arızası
   - Yazılım hatası

**Teknik Çözüm Önerileri:**
1. Kilitleme mekanizmasının komple sökülüp denetlenmesi
2. Mekanik hareket testi ve ayar kontrolü
3. Yardımcı kontakların değiştirilmesi
4. Mil hizalama kontrolü ve gerekirse ayarlanması

Önceki vaka analizlerinde, benzer sorunların %85'i mekanik kilitleme mekanizmasının komple revizyonu ile çözülmüştür.`;
            }
            
            if (userMessageLower.includes('mekanik montaj') || userMessageLower.includes('root cause')) {
                return `**Mekanik Montajda Yaşanan Sorunlar için Root Cause Analizi**

Yapılan derin analize göre, son 6 ayda tekrarlanan mekanik montaj sorunlarının temel nedenleri:

**5 Neden (5 Why) Analizi:**

1. **Neden bara bağlantılarında gevşeme oluyor?** 
   → Çünkü cıvata sıkma torkları standarda uygun değil

2. **Neden torklama standarda uygun değil?** 
   → Çünkü kalibrasyonu yapılmamış el aletleri kullanılıyor

3. **Neden kalibrasyonu yapılmamış aletler kullanılıyor?** 
   → Çünkü kalibrasyon takip sistemi etkin işlemiyor

4. **Neden kalibrasyon takibi etkin yapılmıyor?** 
   → Çünkü kalibrasyon sorumluluğu net tanımlanmamış

5. **Neden sorumluluklar net tanımlanmamış?** 
   → Çünkü prosedürde güncelleme yapılmamış ve eğitim verilmemiş

**Temel Sebep (Root Cause):** Prosedür güncellemesi ve eğitim eksikliği

**Çözüm Önerileri:**
1. Kalibrasyon prosedürünün güncellenmesi ve sorumlulukların net belirlenmesi
2. Montaj çalışanlarına tork değerleri ve kalibrasyon önemi eğitimi
3. Bağlantı tork değerlerinin iş emirlerinde standart olarak belirtilmesi
4. Dijital torkmetre ile doğrulama ve kayıt sistemi oluşturulması
5. Periyodik kalibrasyon programının otomatik hatırlatma sistemine bağlanması`;
            }
            
            if (userMessageLower.includes('kalite sorun') || userMessageLower.includes('tekrarlayan')) {
                return `**Tekrarlayan Kalite Sorunlarını Azaltma Stratejisi**

Kalite verilerinizin derin analizi ve sektör en iyi uygulamaları doğrultusunda:

**Mevcut Durum Analizi:**
- Son 3 ayda tekrarlayan kalite sorunlarının %65'i elektriksel bağlantı hataları
- %22'si mekanik montaj uyumsuzluğu
- %13'ü test prosedürü eksikliği

**Temel Nedenler (Pareto Analizi):**
1. Operatör değişkenliği ve dokümantasyon eksikliği (%42)
2. İş talimatlarının yetersizliği veya güncel olmaması (%27)
3. Kalite kontrol noktalarının yetersizliği (%18)
4. Ekipman ve ölçüm aletleri sorunları (%13)

**İyileştirme Stratejisi:**

1. **İş Standardizasyonu ve Dokümantasyon**
   - Kritik montaj adımları için görsel iş talimatları
   - Elektronik iş takip sistemi (tablet destekli)
   - Kritik nokta kontrollerinin (checkpoint) artırılması

2. **Eğitim ve Yetkinlik**
   - Operatörlere teknik bağlantı eğitimleri (hands-on)
   - Kalite bilinci eğitimi
   - Hata önleyici teknikler (Poka-Yoke) eğitimi

3. **Süreç İzleme ve Kontrol**
   - Kritik parametreler için istatistiksel süreç kontrolü (SPC)
   - Gerçek zamanlı kalite takip panelleri
   - Günlük kalite koordinasyon toplantıları

4. **Sürekli İyileştirme Sistemi**
   - Kalite çemberleri oluşturulması
   - Düzeltici ve önleyici faaliyet sistemi revizyonu
   - Aylık trend analizi ve iyileştirme projelerinin başlatılması

Bu stratejinin 3 aylık bir sürede hata oranını %65 azaltması öngörülmektedir.`;
            }
            
            // Genel uzman cevabı
            return `**Teknik Uzmanlık Değerlendirme**

İlettiğiniz konu hakkında detaylı teknik analiz yapmam için daha spesifik bilgilere ihtiyacım var. Uzmanlık modunda aşağıdaki alanlarda detaylı teknik destek sağlayabilirim:

- Ekipman arıza analizleri ve root cause değerlendirmesi
- Üretim süreçlerinde ileri optimizasyon
- Teknik sorunlarda ileri problem çözme metodolojileri
- Kalite iyileştirme ve hata önleme sistemleri
- Teknik uygulama ve tasarım optimizasyonu

Lütfen analiz etmemi istediğiniz teknik konuyu detaylandırır mısınız? Ekipman modelini, gözlemlenen belirtileri ve yapılan müdahaleleri paylaşırsanız daha etkili bir analiz sunabilirim.`;
        }

        // Konuşmayı LocalStorage'a kaydet
        function saveConversationToStorage() {
            // Mevcut oturumu al
            const currentSession = aiAssistant.currentSession;
            
            // Önceki oturumları yükle
            let conversations = JSON.parse(localStorage.getItem('metsAiConversations') || '[]');
            
            // Mevcut oturum daha önce kaydedilmiş mi kontrol et
            const existingIndex = conversations.findIndex(s => s.id === currentSession.id);
            if (existingIndex !== -1) {
                // Varolan oturumu güncelle
                conversations[existingIndex] = currentSession;
            } else {
                // Yeni oturumu ekle
                conversations.push(currentSession);
            }
            
            // Son 20 konuşmayı tut
            if (conversations.length > 20) {
                conversations = conversations.slice(-20);
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem('metsAiConversations', JSON.stringify(conversations));
        }

        // Markdown tablosunu HTML'e dönüştür
        function convertMarkdownTableToHTML(markdown) {
            const tableRegex = /\|(.+)\|[\r\n]\|([-:\s|]+)\|[\r\n]((?:\|.+\|[\r\n])+)/g;
            const rowRegex = /\|(.+)\|[\r\n]/g;
            
            return markdown.replace(tableRegex, function(match, headerRow, separatorRow, bodyRows) {
                // Başlık sütunlarını ayır
                const headers = headerRow.split('|').map(h => h.trim());
                
                // HTML tablo başlığı oluştur
                let tableHtml = '<table class="table table-bordered table-sm">\n<thead>\n<tr>\n';
                
                // Başlık hücreleri ekle
                headers.forEach(header => {
                    tableHtml += `<th>${header}</th>\n`;
                });
                
                tableHtml += '</tr>\n</thead>\n<tbody>\n';
                
                // Gövde satırlarını işle
                let rowMatch;
                while ((rowMatch = rowRegex.exec(bodyRows)) !== null) {
                    const rowContent = rowMatch[1];
                    const cells = rowContent.split('|').map(c => c.trim());
                    
                    tableHtml += '<tr>\n';
                    cells.forEach(cell => {
                        tableHtml += `<td>${cell}</td>\n`;
                    });
                    tableHtml += '</tr>\n';
                }
                
                tableHtml += '</tbody>\n</table>';
                
                return tableHtml;
            });
        }

        // Aksiyon butonlarını ekle
        function addActionButtons(message) {
            // Rapor butonu
            if (message.includes('[Rapor Oluştur](report)')) {
                message = message.replace(/\[Rapor Oluştur\]\(report\)/g, 
                    '<button class="btn btn-sm btn-warning ms-2 report-action-btn"><i class="bi bi-file-earmark-text"></i> Rapor Oluştur</button>');
            }
            
            // Tahmin butonu
            if (message.includes('[Tahmin Göster](prediction)')) {
                message = message.replace(/\[Tahmin Göster\]\(prediction\)/g, 
                    '<button class="btn btn-sm btn-success ms-2 prediction-action-btn"><i class="bi bi-graph-up-arrow"></i> Tahmin Göster</button>');
            }
            
            return message;
        }

        // Tarih formatlama
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        // Sistem verilerini yükle
        async function loadSystemData() {
            // Gerçek bir API'den veri çekilecek, burada mock veri kullanıyoruz
            aiAssistant.systemTrainingData = {
                orders: [
                    { id: '#0424-1233', status: 'testing', desc: 'RM 36 CB hücresi', delay: 0 },
                    { id: '#0424-1245', status: 'assembly', desc: 'RMU hücresi', delay: 0 },
                    { id: '#0424-1251', status: 'waiting_material', desc: 'Kompakt Hücre', delay: 7 },
                    { id: '#0424-1260', status: 'design', desc: 'Metal Clad Hücre', delay: 0 },
                    { id: '#0424-1272', status: 'started', desc: 'KOF Hücresi', delay: 0 }
                ],
                materials: [
                    { id: 'M001', name: 'Siemens rölesi', stock: 2, required: 8, critical: true },
                    { id: 'M002', name: 'KAP-80/190-95 Akım Trafosu', stock: 3, required: 5, critical: true },
                    { id: 'M003', name: 'M480TB/G-027-95.300UN5 Kablo Başlığı', stock: 12, required: 15, critical: false }
                ],
                tasks: [
                    { id: 'T001', desc: 'Elektriksel test', orderId: '#0424-1233', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T002', desc: 'Kablo bağlantıları', orderId: '#0424-1245', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T003', desc: 'Tedarikçi görüşmeleri', orderId: '#0424-1251', dueDate: '2023-11-08', status: 'inprogress' },
                    { id: 'T004', desc: 'Üretim toplantısı', orderId: '', dueDate: '2023-11-08', status: 'scheduled' },
                    { id: 'T005', desc: 'Kalite kontrol raporu', orderId: '', dueDate: '2023-11-08', status: 'scheduled' }
                ]
            };
            
            return true;
        }

        // Tahmin modellerini başlat 
        function initPredictionModels() {
            aiAssistant.predictionModels = {
                deliveryPrediction: {
                    initialized: true,
                    version: "1.0"
                }
            };
            return true;
        }

        // Öğrenme verisi toplama
        function gatherLearningData() {
            // Sayfa içeriğinden basic veri toplama
            const pageContent = document.body.innerText;
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5');
            const headingTexts = Array.from(headings).map(h => h.textContent);
            
            aiAssistant.learningData.push({
                type: "page_content",
                data: {
                    headings: headingTexts,
                    timestamp: new Date().toISOString()
                }
            });
            
            return true;
        }

        // Etkileşimlerden öğrenme
        function learnFromInteraction(userMessage, aiResponse) {
            // Kullanıcı ve AI mesajlarından öğrenme verisi toplama
            aiAssistant.learningData.push({
                type: "interaction",
                data: {
                    userMessage: userMessage,
                    aiResponse: aiResponse,
                    timestamp: new Date().toISOString()
                }
            });
            
            return true;
        }

        // Teslimat tahmin grafiği oluştur
        function renderDeliveryPredictionChart() {
            const ctx = document.getElementById('deliveryPredictionChart');
            if (!ctx) return;
            
            // Mevcut bir grafik varsa temizle
            if (window.deliveryChart) {
                window.deliveryChart.destroy();
            }
            
            // Grafik verisini hazırla
            const data = {
                labels: ['#0424-1233', '#0424-1245', '#0424-1251', '#0424-1260', '#0424-1272'],
                datasets: [
                    {
                        label: 'Planlanan Teslimat',
                        data: [12, 19, 22, 28, 35],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        type: 'line'
                    },
                    {
                        label: 'Tahmin Edilen Teslimat',
                        data: [12, 19, 30, 31, 38],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        type: 'line', 
                        borderDash: [5, 5]
                    },
                    {
                        label: 'Gerekli Üretim Süresi',
                        data: [10, 15, 18, 22, 28],
                        backgroundColor: 'rgba(46, 204, 113, 0.6)',
                        type: 'bar'
                    }
                ]
            };
            
            // Grafik oluştur
            window.deliveryChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Gün'
                            },
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Sipariş No'
                            }
                        }
                    }
                }
            });
        }

        // Rapor için grafik oluştur
        function renderReportCharts(reportData) {
            // Task Completion Chart
            if (reportData.charts.taskCompletion) {
                const ctx = document.getElementById('reportTaskCompletionChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: reportData.charts.taskCompletion.labels,
                            datasets: reportData.charts.taskCompletion.datasets.map(dataset => ({
                                label: dataset.label,
                                data: dataset.data,
                                borderColor: dataset.borderColor,
                                backgroundColor: dataset.borderColor + '20',
                                tension: 0.3,
                                fill: true
                            }))
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }
            
            // Delay Reasons Chart
            if (reportData.charts.delayReasons) {
                const ctx = document.getElementById('reportDelayReasonsChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: reportData.charts.delayReasons.labels,
                            datasets: [{
                                data: reportData.charts.delayReasons.data,
                                backgroundColor: [
                                    '#e74c3c',
                                    '#3498db',
                                    '#f1c40f',
                                    '#9b59b6',
                                    '#2ecc71'
                                ]
                            }]
                        }
                    });
                }
            }
        }
        
        // Rapor için veri hazırla
        function prepareReportData(type, startDate, endDate, departments, focus, customCriteria) {
            // Gerçek uygulamada API'den veri çekilecek
            // Bu demo için statik veri hazırlayalım
            
            let reportData = {
                title: "",
                date: new Date().toLocaleDateString('tr-TR'),
                dateRange: `${formatDate(startDate)} - ${formatDate(endDate)}`,
                departments: departments.includes('all') ? 'Tüm Birimler' : departments.join(', '),
                summary: "",
                sections: [],
                metrics: {},
                charts: {},
                highlights: []
            };
            
            // Rapor türüne göre içerik oluştur
            switch (type) {
                case 'daily':
                    reportData.title = `Günlük Durum Raporu (${formatDate(endDate)})`;
                    reportData.summary = "Bu rapor, bugünkü üretim durumu, tamamlanan görevler, sorunlar ve aksiyonları içermektedir.";
                    reportData.sections = [
                        {
                            title: "Üretim Özeti",
                            content: "Bugün 5 sipariş üzerinde çalışıldı, 2 sipariş tamamlandı. Toplam 18 görev planlandı, 15 görev tamamlandı."
                        },
                        {
                            title: "Kritik Durumlar",
                            content: "1 siparişte malzeme tedariki kaynaklı gecikme yaşanıyor (#0424-1251). Satın alma birimi alternatif tedarikçi araştırması yapıyor."
                        },
                        {
                            title: "Tamamlanan İşler",
                            content: "- RM 36 CB hücresi elektriksel testleri tamamlandı (#0424-1233)\n- Mekanik montaj işlemleri tamamlandı (#0424-1245)\n- Kablo başlığı montajı tamamlandı (#0424-1239)"
                        }
                    ];
                    reportData.metrics = {
                        planCompletion: 83,
                        delayedTasks: 2,
                        completedOrders: 2,
                        materialShortages: 1
                    };
                    reportData.highlights = [
                        "Üretim planı %83 oranında gerçekleştirildi",
                        "2 görevde gecikme var, satın alma sürecinden kaynaklı",
                        "3 hücrenin montajı tamamlandı ve teste hazır"
                    ];
                    break;
                    
                case 'weekly':
                    reportData.title = "Haftalık İlerleme Raporu";
                    // Rapor içeriği oluşturulacak
                    break;
                    
                case 'meeting':
                    reportData.title = "Toplantı Özeti ve Aksiyon Noktaları";
                    // Rapor içeriği oluşturulacak
                    break;
                    
                // Diğer rapor tipleri...
            }
            
            // Odak alanına göre ek bilgiler ekle
            if (focus === 'delays') {
                reportData.sections.push({
                    title: "Gecikme Analizi",
                    content: "Son 7 günde yaşanan gecikmelerin ana nedeni malzeme tedarikindeki aksamalar (%45) ve test sürecindeki teknik sorunlar (%30). Özellikle akım trafosu tedariğinde yaşanan gecikmeler kritik öneme sahip."
                });
            } else if (focus === 'materials') {
                reportData.sections.push({
                    title: "Malzeme Durumu",
                    content: "Kritik stok seviyesindeki malzemeler: Siemens rölesi (2 adet, 8 adet ihtiyaç), KAP-80/190-95 Akım Trafosu (3 adet, 5 adet ihtiyaç). Son 7 günde 4 acil malzeme siparişi verildi."
                });
            }
            
            // Özel kriterler varsa ekle
            if (customCriteria) {
                reportData.sections.push({
                    title: "Özel Analiz",
                    content: `Talep ettiğiniz "${customCriteria}" konusu hakkında yapılan analiz sonuçları: [Burada detaylı analiz sonuçları yer alacak]`
                });
            }
            
            // Grafik verileri ekle
            reportData.charts = {
                taskCompletion: {
                    labels: ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma'],
                    datasets: [
                        {
                            label: 'Planlanan',
                            data: [12, 15, 10, 8, 18],
                            borderColor: '#3498db'
                        },
                        {
                            label: 'Tamamlanan',
                            data: [10, 13, 8, 6, 15],
                            borderColor: '#2ecc71'
                        }
                    ]
                },
                delayReasons: {
                    labels: ['Malzeme Tedariki', 'Teknik Sorunlar', 'Personel Eksikliği', 'Test Sorunları', 'Diğer'],
                    data: [45, 30, 10, 10, 5]
                }
            };
            
            return reportData;
        }

        // Rapor HTML içeriği oluşturma
        function generateReportHTML(reportData, includeCharts) {
            let html = `
                <div class="report-header text-center mb-4">
                    <h3>${reportData.title}</h3>
                    <p class="text-muted">${reportData.dateRange} | ${reportData.departments}</p>
                    <hr>
                </div>
                
                <div class="report-summary mb-4">
                    <h5>Özet</h5>
                    <p>${reportData.summary}</p>
                </div>
                
                <div class="report-metrics mb-4">
                    <div class="row">
                    ${reportData.metrics.planCompletion !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Plan Tamamlama</h6>
                                    <h3 class="card-text">${reportData.metrics.planCompletion}%</h3>
                                </div>
                            </div>
                        </div>` : ''}
                    
                    ${reportData.metrics.delayedTasks !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Geciken İşler</h6>
                                    <h3 class="card-text">${reportData.metrics.delayedTasks}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                        
                    ${reportData.metrics.completedOrders !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Tamamlanan Siparişler</h6>
                                    <h3 class="card-text">${reportData.metrics.completedOrders}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                        
                    ${reportData.metrics.materialShortages !== undefined ? `
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-muted">Malzeme Eksiklikleri</h6>
                                    <h3 class="card-text">${reportData.metrics.materialShortages}</h3>
                                </div>
                            </div>
                        </div>` : ''}
                    </div>
                </div>
            `;
            
            // Grafikleri ekle
            if (includeCharts && Object.keys(reportData.charts).length > 0) {
                html += `
                    <div class="report-charts mb-4">
                        <div class="row">
                            ${reportData.charts.taskCompletion ? `
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header">Görev Tamamlama</div>
                                    <div class="card-body">
                                        <canvas id="reportTaskCompletionChart"></canvas>
                                    </div>
                                </div>
                            </div>` : ''}
                            
                            ${reportData.charts.delayReasons ? `
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header">Gecikme Nedenleri (%)</div>
                                    <div class="card-body">
                                        <canvas id="reportDelayReasonsChart"></canvas>
                                    </div>
                                </div>
                            </div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Bölümleri ekle
            html += `<div class="report-sections">`;
            reportData.sections.forEach(section => {
                html += `
                    <div class="report-section mb-4">
                        <h5>${section.title}</h5>
                        <div class="card">
                            <div class="card-body">
                                ${section.content.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            
            // Rapor altbilgisi
            html += `
                <div class="report-footer text-center mt-4 pt-3 border-top">
                    <p class="small text-muted">Bu rapor METS Yapay Zeka Asistanı tarafından ${reportData.date} tarihinde otomatik olarak oluşturulmuştur.</p>
                </div>
            `;
            
            return html;
        }

        // Bildirim göster
        function showNetworkStatusNotification(message, type = 'info') {
            // Toast bildirim gösterimi
            const toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast, {
                delay: 3000
            });
            bsToast.show();
            
            // Otomatik kaldır
            setTimeout(() => {
                if (toastContainer.contains(toast)) {
                    toastContainer.removeChild(toast);
                }
            }, 3500);
        }

        // Eğitim verilerini yükle
        function loadTrainingData() {
            // Gerçek uygulamada API'den yüklenecek
            // Demo için temel verileri manuel ekle
            aiAssistant.systemTrainingData = {
                // Temel eğitim verileri
                basics: {
                    companyInfo: "METS - Mehmet Endüstriyel Takip Sistemi, Endüstriyel üretim takibi, malzeme yönetimi ve üretim optimizasyonu çözümleri sunan bir sistemdir.",
                    products: ["Orta Gerilim Hücreleri", "Alçak Gerilim Panoları", "Reaktif Güç Kompanzasyon Sistemleri", "Özel Tasarım Elektrik Dağıtım Sistemleri"]
                }
            };
            
            return true;
        }
    </script>
    
    <!-- Gelişmiş Yapay Zeka Asistanı -->
    <script>
        // Gelişmiş Yapay Zeka Asistanı için global değişkenler
        const aiAssistant = {
            conversationHistory: [],
            currentMode: 'assistant',
            context: null,
            systemTrainingData: {},
            learningData: [],
            predictionModels: {},
            reportTemplates: {},
            currentSession: {
                id: `session-${Date.now()}`,
                startTime: new Date().toISOString(),
                messages: []
            },
            modelVersion: '1.0.5',
            knowledgeBase: {
                lastUpdated: new Date().toISOString(),
                sources: ['technical-docs', 'erp-data', 'production-history']
            },
            continuousLearningEnabled: true
        };
        
        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            // AI chatbot butonu için event listener ekle
            const chatbotBtn = document.getElementById('ai-chatbot-btn');
            if (chatbotBtn) {
                chatbotBtn.addEventListener('click', openAIAssistant);
            }
            
            // Yapay Zeka sistemini başlat
            initializeAISystem();
        });

        // Yapay Zeka Sistemini Başlat
        async function initializeAISystem() {
            console.log("Gelişmiş Yapay Zeka Sistemi başlatılıyor...");
            
            try {
                // Sistem verilerini yükle
                await loadSystemData();
                
                // Tahmin modellerini başlat
                initPredictionModels();
                
                // Öğrenme verisini topla
                gatherLearningData();
                
                // Eğitim verisini yükle
                loadTrainingData();
                
                // Geçmiş konuşmaları yükle
                loadConversationsFromStorage();
                
                console.log("Gelişmiş Yapay Zeka Sistemi başarıyla başlatıldı");
                
                // Otomatik uyarı işleme döngüsünü başlat (sürekli öğrenme)
                startContinuousLearning();
            } catch (error) {
                console.error("Yapay Zeka Sistemi başlatılırken hata:", error);
                showNetworkStatusNotification('AI sistemi başlatılırken bir sorun oluştu', 'danger');
            }
        }

        // Sürekli öğrenme döngüsünü başlat
        function startContinuousLearning() {
            if (!aiAssistant.continuousLearningEnabled) return;
            
            console.log("Sürekli öğrenme döngüsü başlatılıyor...");
            
            // Her 30 dakikada bir sistem verilerini analiz et ve öğren
            setInterval(async () => {
                try {
                    // Yeni verileri topla
                    const newData = await collectNewSystemData();
                    
                    // Topladığın yeni verilerle öğren
                    learnFromNewData(newData);
                    
                    // Tahmin modelini güncelle
                    updatePredictionModels();
                    
                    console.log("Yapay Zeka sistemi yeni verilerden öğrendi");
                } catch (error) {
                    console.error("Sürekli öğrenme sürecinde hata:", error);
                }
            }, 30 * 60 * 1000); // 30 dakika
            
            // Her 2 saatte bir uyarı analizi yap
            setInterval(() => {
                try {
                    // Sistem verilerine göre potansiyel sorunları tespit et
                    const potentialIssues = detectPotentialIssues();
                    
                    // Ciddi sorunlar varsa bildirim oluştur
                    if (potentialIssues && potentialIssues.length > 0) {
                        notifyAboutPotentialIssues(potentialIssues);
                    }
                } catch (error) {
                    console.error("Uyarı analizi sürecinde hata:", error);
                }
            }, 2 * 60 * 60 * 1000); // 2 saat
        }

        // Yeni sistem verilerini topla
        async function collectNewSystemData() {
            // Gerçek uygulamada API'den veri çekilecek
            // Bu demo sürümünde simüle edilmiş veri döndürüyoruz
            return {
                orders: [
                    { id: '#0424-1285', status: 'new', description: 'Yeni sipariş eklendi', timestamp: Date.now() },
                    { id: '#0424-1233', status: 'completed', description: 'Sipariş tamamlandı', timestamp: Date.now() }
                ],
                materials: [
                    { id: 'M002', name: 'KAP-80/190-95 Akım Trafosu', stock: 5, critical: false, timestamp: Date.now() }
                ],
                issues: [
                    { id: 'I001', orderId: '#0424-1245', description: 'Malzeme gecikmesi çözüldü', status: 'resolved', timestamp: Date.now() }
                ]
            };
        }

        // Yeni verilerle öğren
        function learnFromNewData(newData) {
            if (!newData) return;
            
            // Öğrenme verilerine ekle
            aiAssistant.learningData.push({
                type: 'system_data',
                timestamp: new Date().toISOString(),
                data: newData
            });
            
            // Öğrenme verilerini limitle (son 100 veriyi tut)
            if (aiAssistant.learningData.length > 100) {
                aiAssistant.learningData = aiAssistant.learningData.slice(-100);
            }
            
            // Sistem bilgi tabanını güncelle
            updateKnowledgeBase(newData);
            
            // Öğrenme verilerini persistent storage'da sakla
            localStorage.setItem('metsAiLearningData', JSON.stringify(aiAssistant.learningData));
        }

        // Bilgi tabanını güncelle
        function updateKnowledgeBase(newData) {
            aiAssistant.knowledgeBase.lastUpdated = new Date().toISOString();
            
            // Burada gerçek bir uygulamada bilgi tabanı güncelleme işlemleri yapılır
            // Örneğin: Makine öğrenmesi modelinin retrain edilmesi, veri paternlerinin analizi vb.
            
            console.log("Bilgi tabanı güncellendi:", aiAssistant.knowledgeBase.lastUpdated);
        }

        // Tahmin modellerini güncelle
        function updatePredictionModels() {
            // Gerçek bir uygulamada makine öğrenmesi modellerini güncelleme işlemleri burada yapılır
            console.log("Tahmin modelleri güncellendi");
        }

        // Potansiyel sorunları tespit et
        function detectPotentialIssues() {
            // Gerçek bir uygulamada makine öğrenmesi ve veri analiziyle sorun tespiti yapılır
            // Bu demo için simüle edilmiş veri döndürüyoruz
            
            // Rastgele sorun tespiti
            if (Math.random() > 0.7) { // %30 ihtimalle sorun tespit et
                return [
                    {
                        type: 'material_shortage',
                        severity: 'high',
                        description: 'Siemens rölesi stok seviyesi kritik eşiğin altına düşecek',
                        affectedOrders: ['#0424-1251'],
                        prediction: 'Önümüzdeki 3 gün içinde stok tükenebilir',
                        confidence: 0.85
                    }
                ];
            }
            
            return [];
        }

        // Potansiyel sorunlar hakkında bildirim oluştur
        function notifyAboutPotentialIssues(issues) {
            if (!issues || issues.length === 0) return;
            
            issues.forEach(issue => {
                // Uyarı bildirimi göster
                showNetworkStatusNotification(
                    `AI Tahmin: ${issue.description} - ${issue.prediction}`, 
                    issue.severity === 'high' ? 'danger' : 'warning'
                );
                
                // Yapay Zeka rozeti için sayacı güncelle
                const badge = document.querySelector('.notification-badge');
                if (badge) {
                    let count = parseInt(badge.textContent) || 0;
                    badge.textContent = count + 1;
                    badge.style.display = 'flex';
                    badge.classList.add('has-alerts');
                }
            });
        }

        // Yapay Zeka Asistanını aç
        function openAIAssistant() {
            // AI Chat Modal'ını güncelle ve daha gelişmiş hale getir
            const aiChatModal = document.getElementById('aiChatModal');
            // Eski modal varsa kaldır
            if (aiChatModal) {
                aiChatModal.remove();
            }
            
            // Yeni gelişmiş AI Chat Modal'ı oluştur
            const modalHtml = `
                <div class="modal fade" id="aiChatModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title"><i class="bi bi-robot"></i> METS Asistan</h5>
                                <div class="ms-auto me-2">
                                    <div class="dropdown d-inline-block me-2">
                                        <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" id="aiModeSwitcher" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-gear"></i> Mod
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="aiModeSwitcher">
                                            <li><a class="dropdown-item active" href="#" data-ai-mode="assistant"><i class="bi bi-chat-dots"></i> Asistan Modu</a></li>
                                            <li><a class="dropdown-item" href="#" data-ai-mode="analyst"><i class="bi bi-bar-chart"></i> Analiz Modu</a></li>
                                            <li><a class="dropdown-item" href="#" data-ai-mode="reporter"><i class="bi bi-file-text"></i> Rapor Modu</a></li>
                                            <li><a class="dropdown-item" href="#" data-ai-mode="predictor"><i class="bi bi-graph-up-arrow"></i> Tahmin Modu</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item" href="#" data-ai-mode="expert"><i class="bi bi-mortarboard"></i> Uzman Modu</a></li>
                                        </ul>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-light" id="aiHistoryBtn" title="Konuşma Geçmişi">
                                        <i class="bi bi-clock-history"></i>
                                    </button>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                            </div>
                            <div class="modal-body" style="height: 500px; overflow-y: auto;">
                                <div id="chatMessages" class="pb-5"></div>
                            </div>
                            <div class="modal-footer p-2">
                                <div class="input-group" style="position: relative;">
                                    <span class="input-group-text bg-light" id="aiContextIndicator" title="Mevcut Bağlam">
                                        <i class="bi bi-chat"></i>
                                    </span>
                                    <textarea type="text" id="aiChatInput" class="form-control" placeholder="Sorunuzu yazın..." rows="1" style="resize: none;"></textarea>
                                    <button class="btn btn-primary" id="sendChatBtn">Gönder</button>
                                    <button class="btn btn-outline-secondary" type="button" id="aiAttachBtn" title="Dosya/Veri Ekle">
                                        <i class="bi bi-paperclip"></i>
                                    </button>
                                    <div id="aiSuggestions" class="position-absolute bg-white shadow rounded p-2" style="bottom: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; display: none; z-index: 1050;">
                                        <p class="text-muted small mb-2">Önerilen Sorular:</p>
                                        <div class="d-flex flex-wrap gap-1" id="aiSuggestionsContent"></div>
                                    </div>
                                </div>
                                <div class="w-100">
                                    <div class="form-text text-end small">
                                        <a href="#" id="aiToggleSuggestions">Önerileri göster</a> | 
                                        <a href="#" id="aiClearConversation">Konuşmayı temizle</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Rapor Oluşturucu Modal -->
                <div class="modal fade" id="aiReportModal" tabindex="-1" aria-labelledby="aiReportModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="aiReportModalLabel"><i class="bi bi-file-earmark-text"></i> Rapor Oluşturucu</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="reportType" class="form-label">Rapor Türü</label>
                                    <select class="form-select" id="reportType">
                                        <option value="daily">Günlük Durum Raporu</option>
                                        <option value="weekly">Haftalık İlerleme Raporu</option>
                                        <option value="monthly">Aylık Üretim Raporu</option>
                                        <option value="meeting">Toplantı Özeti ve Aksiyon Noktaları</option>
                                        <option value="performance">Birim Performans Raporu</option>
                                        <option value="forecast">Üretim Tahmin Raporu</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="reportDateRange" class="form-label">Tarih Aralığı</label>
                                    <div class="input-group">
                                        <input type="date" class="form-control" id="reportStartDate">
                                        <span class="input-group-text">ile</span>
                                        <input type="date" class="form-control" id="reportEndDate">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="reportDepartments" class="form-label">İlgili Birimler</label>
                                    <select class="form-select" id="reportDepartments" multiple>
                                        <option value="all" selected>Tüm Birimler</option>
                                        <option value="sales">Satış</option>
                                        <option value="design-electrical">Elektrik Tasarım</option>
                                        <option value="design-mechanical">Mekanik Tasarım</option>
                                        <option value="purchasing">Satın Alma</option>
                                        <option value="production-mechanical">Mekanik Üretim</option>
                                        <option value="production-assembly">Montaj</option>
                                        <option value="production-wiring">Kablaj</option>
                                        <option value="quality">Kalite Kontrol</option>
                                        <option value="testing">Test</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="reportFocus" class="form-label">Rapor Odağı</label>
                                    <select class="form-select" id="reportFocus">
                                        <option value="overview" selected>Genel Bakış</option>
                                        <option value="delays">Gecikmeler ve Çözümler</option>
                                        <option value="materials">Malzeme Durumu</option>
                                        <option value="quality">Kalite Sorunları</option>
                                        <option value="resources">Kaynak Kullanımı</option>
                                        <option value="custom">Özel Rapor</option>
                                    </select>
                                </div>
                                <div class="mb-3" id="customReportCriteriaContainer" style="display: none;">
                                    <label for="customReportCriteria" class="form-label">Özel Rapor Kriterleri</label>
                                    <textarea class="form-control" id="customReportCriteria" rows="3" placeholder="Özel rapor için incelenmesini istediğiniz noktaları belirtin..."></textarea>
                                </div>
                                <div class="alert alert-info">
                                    <h6><i class="bi bi-info-circle"></i> Yapay Zeka Asistanınız raporu nasıl hazırlayacak?</h6>
                                    <p class="mb-0 small">Sistem, seçtiğiniz kriterlere göre üretim verilerini, uyarıları, malzeme durumunu, iş emirlerini ve geçmiş verileri analiz ederek kapsamlı bir rapor oluşturacaktır. Sorunlar, tamamlanan işler ve öneriler dahil edilecektir.</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="form-check me-auto">
                                    <input class="form-check-input" type="checkbox" id="includeCharts" checked>
                                    <label class="form-check-label" for="includeCharts">
                                        Grafikleri dahil et
                                    </label>
                                </div>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                                <button type="button" class="btn btn-primary" id="generateReportBtn">Rapor Oluştur</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Tahmin Paneli Modal -->
                <div class="modal fade" id="aiPredictionModal" tabindex="-1" aria-labelledby="aiPredictionModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="aiPredictionModalLabel"><i class="bi bi-graph-up-arrow"></i> Üretim Tahmin Paneli</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-4">
                                    <div class="col-md-4">
                                        <div class="card h-100">
                                            <div class="card-header">
                                                Potansiyel Riskler
                                            </div>
                                            <div class="card-body">
                                                <div id="predictionRisks" class="list-group">
                                                    <div class="list-group-item list-group-item-danger d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="mb-1">Malzeme Tedarik Gecikmesi</h6>
                                                            <p class="mb-1 small">Akım trafosu tedarikinde 1 hafta gecikme riski (%78)</p>
                                                        </div>
                                                        <span class="badge bg-danger">Kritik</span>
                                                    </div>
                                                    <div class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="mb-1">Üretim Kapasitesi Aşımı</h6>
                                                            <p class="mb-1 small">Mekanik üretim kapasitesi 15-20 Kasım arası yetersiz kalabilir (%65)</p>
                                                        </div>
                                                        <span class="badge bg-warning">Dikkat</span>
                                                    </div>
                                                    <div class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <h6 class="mb-1">Test Süresi Yetersizliği</h6>
                                                            <p class="mb-1 small">#0424-1251 siparişinin testi için zaman kısıtlı (%60)</p>
                                                        </div>
                                                        <span class="badge bg-warning">Dikkat</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-footer text-end">
                                                <a href="#" class="text-decoration-none small">Tüm riskleri gör <i class="bi bi-chevron-right"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card h-100">
                                            <div class="card-header">
                                                Teslimat Tahmin Grafiği
                                            </div>
                                            <div class="card-body">
                                                <canvas id="deliveryPredictionChart" height="250"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                Öneriler
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item">
                                                        <h6 class="mb-1">Alternatif Tedarikçi Seçeneği</h6>
                                                        <p class="mb-1 small">Akım trafosu için X Firmasından acil tedarik seçeneği değerlendirilmeli. Analiz edilen geçmiş verilerde bu firmanın acil durumlarda 3 günlük teslimat süresi mevcut.</p>
                                                        <div class="d-flex justify-content-end">
                                                            <button class="btn btn-sm btn-outline-primary me-2">Detay</button>
                                                            <button class="btn btn-sm btn-success">Uygula</button>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <h6 class="mb-1">Üretim Önceliklendirmesi</h6>
                                                        <p class="mb-1 small">Mekanik üretim kapasitesi için #0424-1251 siparişinin önceliğini artırarak, diğer işleri ötelemeniz önerilir.</p>
                                                        <div class="d-flex justify-content-end">
                                                            <button class="btn btn-sm btn-outline-primary me-2">Detay</button>
                                                            <button class="btn btn-sm btn-success">Uygula</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                Optimizasyon Fırsatları
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group">
                                                    <div class="list-group-item">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <h6 class="mb-1">Verimlilik İyileştirmesi</h6>
                                                            <span class="badge bg-info">+15% Potansiyel</span>
                                                        </div>
                                                        <p class="mb-1 small">Mekanik montaj süreçlerinde son 3 ayda tekrarlanan hataları analiz ederek, süreç değişikliği önermek istiyorum.</p>
                                                        <div class="progress mt-2" style="height: 5px;">
                                                            <div class="progress-bar bg-info" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <h6 class="mb-1">Stok Optimizasyonu</h6>
                                                            <span class="badge bg-success">Maliyet Tasarrufu</span>
                                                        </div>
                                                        <p class="mb-1 small">Bara malzemesi için JIT (tam zamanında) tedarik modelini öneririm. Simülasyon modelim %12 maliyet tasarrufu öngörüyor.</p>
                                                        <div class="progress mt-2" style="height: 5px;">
                                                            <div class="progress-bar bg-success" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-footer text-end">
                                                <a href="#" class="text-decoration-none small">Tüm fırsatları analiz et <i class="bi bi-chevron-right"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-primary" id="refreshPredictionBtn">
                                    <i class="bi bi-arrow-repeat"></i> Tahminleri Güncelle
                                </button>
                                <button type="button" class="btn btn-primary" id="predictCustomScenarioBtn">
                                    <i class="bi bi-calculator"></i> Senaryo Analizi
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // HTML'i sayfaya ekle
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // CSS ekle
            const styleElement = document.createElement('style');
            styleElement.textContent = `
                /* Chatbot arayüz stilleri */
                .chat-message {
                    margin-bottom: 10px;
                    padding: 12px 15px;
                    border-radius: 10px;
                    max-width: 85%;
                    position: relative;
                    line-height: 1.5;
                }
                
                .user-message {
                    background-color: #e3f2fd;
                    margin-left: auto;
                    border-bottom-right-radius: 2px;
                }
                
                .ai-message {
                    background-color: #f6f8fa;
                    margin-right: auto;
                    border-bottom-left-radius: 2px;
                    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
                }
                
                .ai-message:before {
                    content: '';
                    position: absolute;
                    left: -6px;
                    bottom: 0;
                    width: 10px;
                    height: 10px;
                    background-color: #f6f8fa;
                    transform: skewX(-45deg);
                    border-radius: 2px;
                }
                
                .user-message:after {
                    content: '';
                    position: absolute;
                    right: -6px;
                    bottom: 0;
                    width: 10px;
                    height: 10px;
                    background-color: #e3f2fd;
                    transform: skewX(45deg);
                    border-radius: 2px;
                }
                
                .chat-message code {
                    background-color: rgba(0, 0, 0, 0.05);
                    padding: 2px 5px;
                    border-radius: 3px;
                    font-family: Consolas, Monaco, 'Andale Mono', monospace;
                    font-size: 0.9em;
                }
                
                .chat-message pre {
                    background-color: #282c34;
                    color: #f8f8f2;
                    padding: 10px;
                    border-radius: 5px;
                    overflow-x: auto;
                    margin: 10px 0;
                }
                
                .suggestion-btn {
                    transition: all 0.2s ease;
                }
                
                .suggestion-btn:hover {
                    transform: translateY(-2px);
                }
                
                /* Typing indicator animation */
                .typing-indicator {
                    display: inline-flex;
                    align-items: center;
                }
                
                .typing-indicator span {
                    width: 6px;
                    height: 6px;
                    background-color: #3498db;
                    border-radius: 50%;
                    display: inline-block;
                    margin: 0 1px;
                    animation: typing 1s infinite ease-in-out;
                }
                
                .typing-indicator span:nth-child(1) {
                    animation-delay: 0.1s;
                }
                
                .typing-indicator span:nth-child(2) {
                    animation-delay: 0.2s;
                }
                
                .typing-indicator span:nth-child(3) {
                    animation-delay: 0.3s;
                }
                
                @keyframes typing {
                    0% { transform: translateY(0); }
                    50% { transform: translateY(-5px); }
                    100% { transform: translateY(0); }
                }
            `;
            document.head.appendChild(styleElement);
            
            // Event listener'ları ekle
            setupAIAssistantEventListeners();
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('aiChatModal'));
            modal.show();
            
            // İlk kez açılıyorsa ya da yeni oturum başlatıldıysa karşılama mesajı göster
            if (aiAssistant.currentSession.messages.length === 0) {
                displayAIMessage(getWelcomeMessage(), false);
                displaySuggestions();
            }
            
            // Bildirim işaretini temizle
            const badge = document.querySelector('.notification-badge');
            if (badge) badge.style.display = 'none';
            
            // Input alanına odaklan
            setTimeout(() => {
                const inputField = document.getElementById('aiChatInput');
                if (inputField) inputField.focus();
                
                // Textarea otomatik boyutlandırma
                inputField.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight < 150) ? (this.scrollHeight) + 'px' : '150px';
                });
            }, 500);
        }
        
        // Gelişmiş AI Event Listener'ları
        function setupAIAssistantEventListeners() {
            // AI Mod değiştirme
            document.querySelectorAll('[data-ai-mode]').forEach(element => {
                element.addEventListener('click', function(e) {
                    e.preventDefault();
                    changeAIMode(this.dataset.aiMode);
                });
            });
            
            // Mesaj gönderme butonu
            const sendChatBtn = document.getElementById('sendChatBtn');
            if (sendChatBtn) {
                sendChatBtn.addEventListener('click', sendMessageToAI);
            }
            
            // Enter tuşu ile mesaj gönderme
            const aiChatInput = document.getElementById('aiChatInput');
            if (aiChatInput) {
                aiChatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessageToAI();
                    }
                });
            }
            
            // Konuşma temizleme
            const aiClearConversation = document.getElementById('aiClearConversation');
            if (aiClearConversation) {
                aiClearConversation.addEventListener('click', function(e) {
                    e.preventDefault();
                    clearConversation();
                });
            }
            
            // Önerileri gösterme/gizleme
            const aiToggleSuggestions = document.getElementById('aiToggleSuggestions');
            if (aiToggleSuggestions) {
                aiToggleSuggestions.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleSuggestions();
                });
            }
            
            // Rapor oluşturucu için özel alan gösterimi
            const reportFocus = document.getElementById('reportFocus');
            if (reportFocus) {
                reportFocus.addEventListener('change', function() {
                    const customContainer = document.getElementById('customReportCriteriaContainer');
                    if (customContainer) {
                        customContainer.style.display = this.value === 'custom' ? 'block' : 'none';
                    }
                });
            }
            
            // Rapor oluşturma butonu
            const generateReportBtn = document.getElementById('generateReportBtn');
            if (generateReportBtn) {
                generateReportBtn.addEventListener('click', generateAIReport);
            }
            
            // Tahmin yenileme butonu
            const refreshPredictionBtn = document.getElementById('refreshPredictionBtn');
            if (refreshPredictionBtn) {
                refreshPredictionBtn.addEventListener('click', function() {
                    renderDeliveryPredictionChart();
                    showNetworkStatusNotification('Tahminler güncellendi', 'success');
                });
            }
            
            // Dosya ekleme butonu
            const aiAttachBtn = document.getElementById('aiAttachBtn');
            if (aiAttachBtn) {
                aiAttachBtn.addEventListener('click', function() {
                    showDataAttachmentOptions();
                });
            }
        }
        
        // Yapay Zekaya mesaj gönderme
        function sendMessageToAI() {
            const inputField = document.getElementById('aiChatInput');
            const messagesContainer = document.getElementById('chatMessages');
            
            if (!inputField || !messagesContainer) return;
            
            const userMessage = inputField.value.trim();
            
            if (!userMessage) return;
            
            // Kullanıcı mesajını göster
            displayUserMessage(userMessage);
            
            // Input alanını temizle
            inputField.value = '';
            inputField.style.height = 'auto';
            
            // Öneri panelini kapat
            const suggestionsPanel = document.getElementById('aiSuggestions');
            if (suggestionsPanel) suggestionsPanel.style.display = 'none';
            
            // Yükleniyor mesajı göster - yazıyor animasyonu
            const loadingElement = document.createElement('div');
            loadingElement.id = 'ai-loading-message';
            loadingElement.className = 'chat-message ai-message d-flex align-items-center';
            loadingElement.innerHTML = `
                <div class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
                <span class="ms-2">METS AI düşünüyor...</span>
            `;
            messagesContainer.appendChild(loadingElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Mesajı oturum geçmişine kaydet
            aiAssistant.currentSession.messages.push({
                role: 'user',
                content: userMessage,
                timestamp: new Date().toISOString()
            });
            
            // Cevabı oluştur ve göster (yapay gecikme ile gerçekçi bir deneyim)
            setTimeout(() => {
                processAIResponse(userMessage);
            }, 1200);
        }
        
        // Yapay Zeka cevabını işle
        function processAIResponse(userMessage) {
            // Yükleniyor mesajını kaldır
            const loadingElement = document.getElementById('ai-loading-message');
            if (loadingElement) loadingElement.remove();
            
            // Güncel mod ve bağlama göre cevap üret
            let aiResponse;
            
            switch (aiAssistant.currentMode) {
                case 'analyst':
                    aiResponse = generateAnalysisResponse(userMessage);
                    break;
                case 'reporter':
                    aiResponse = generateReporterResponse(userMessage);
                    break;
                case 'predictor':
                    aiResponse = generatePredictionResponse(userMessage);
                    break;
                case 'expert':
                    aiResponse = generateExpertResponse(userMessage);
                    break;
                default:
                    aiResponse = generateAssistantResponse(userMessage);
            }
            
            // Dil anlama yeteneklerini kullanarak doğal dil işleme uygula
            aiResponse = applyNLPFeatures(userMessage, aiResponse);
            
            // Cevabı göster
            displayAIMessage(aiResponse);
            
            // Mesajı oturum geçmişine kaydet
            aiAssistant.currentSession.messages.push({
                role: 'assistant',
                content: aiResponse,
                timestamp: new Date().toISOString()
            });
            
            // Konuşmayı LocalStorage'a kaydet
            saveConversationToStorage();
            
            // Öneri butonlarını göster
            setTimeout(() => {
                displaySuggestions();
            }, 1000);
            
            // Yapay Zeka öğrenme sürecini çalıştır
            learnFromInteraction(userMessage, aiResponse);
        }

        // Önerileri göster
        function displaySuggestions() {
            const suggestionsContainer = document.getElementById('aiSuggestionsContent');
            if (!suggestionsContainer) return;
            
            // Önerilen sorular
            const suggestedQueries = {
                assistant: [
                    "Devam eden siparişlerin durumu nedir?", 
                    "Hangi siparişlerde gecikme riski var?", 
                    "Acil tedarik edilmesi gereken malzemeler hangileri?",
                    "Bugün tamamlanacak görevler nelerdir?"
                ],
                analyst: [
                    "Son 30 günün verimlilik analizi yapabilir misin?", 
                    "En fazla gecikmeye sebep olan üretim aşaması hangisi?",
                    "Birimler arası iş transferinde sorun yaşanan noktalar neler?",
                    "Hangi ürünlerin üretiminde en çok sorun yaşıyoruz?"
                ],
                reporter: [
                    "Bugünkü üretim durumunu özetleyen bir rapor hazırla", 
                    "Geçen haftanın performans özeti için rapor oluştur",
                    "Bugünkü kritik durumlar ve alınan aksiyonları raporla",
                    "Yönetim toplantısı için özet rapor hazırla"
                ],
                predictor: [
                    "Önümüzdeki ay için üretim kapasitemiz yeterli olacak mı?", 
                    "Hangi siparişlerde teslimat gecikme riski var?",
                    "Önümüzdeki hafta için malzeme tedariğinde sorun yaşayacak mıyız?",
                    "Kapasite planlaması için önerilerini paylaşır mısın?"
                ],
                expert: [
                    "RM 36 CB hücresinde oluşan arızanın olası nedenlerini analiz et", 
                    "Mekanik montajda yaşanan sorun için root cause analizi yap",
                    "Tekrarlayan kalite sorunlarını azaltmak için öneri geliştir",
                    "Süreç iyileştirme için öncelikli alanları belirle"
                ]
            };
            
            // Mevcut moda göre öneriler + dinamik öneriler
            let suggestions = suggestedQueries[aiAssistant.currentMode] || suggestedQueries.assistant;
            
            // Geçmiş etkileşimlere dayalı dinamik öneriler ekle
            const dynamicSuggestions = generateDynamicSuggestions();
            if (dynamicSuggestions.length > 0) {
                suggestions = [...dynamicSuggestions, ...suggestions.slice(0, 2)];
            }
            
            suggestionsContainer.innerHTML = '';
            
            suggestions.forEach(suggestion => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn btn-sm btn-outline-secondary suggestion-btn mb-1';
                button.textContent = suggestion;
                button.addEventListener('click', () => {
                    const inputField = document.getElementById('aiChatInput');
                    if (inputField) {
                        inputField.value = suggestion;
                        const suggestionsPanel = document.getElementById('aiSuggestions');
                        if (suggestionsPanel) suggestionsPanel.style.display = 'none';
                        sendMessageToAI();
                    }
                });
                suggestionsContainer.appendChild(button);
            });
        }

        // Dinamik öneri oluşturma
        function generateDynamicSuggestions() {
            const suggestions = [];
            
            // Mevcut bağlama dayalı öneriler
            if (aiAssistant.context === 'order') {
                // Son konuşulan sipariş numarası var mı?
                const orderRegex = /#0424-\d{4}/g;
                let lastOrderId = null;
                
                for (let i = aiAssistant.currentSession.messages.length - 1; i >= 0; i--) {
                    const message = aiAssistant.currentSession.messages[i];
                    const match = message.content.match(orderRegex);
                    if (match && match.length > 0) {
                        lastOrderId = match[0];
                        break;
                    }
                }
                
                if (lastOrderId) {
                    suggestions.push(`${lastOrderId} siparişinin güncel durumu nedir?`);
                    suggestions.push(`${lastOrderId} için teslim tarihi değişti mi?`);
                }
            }
            
            return suggestions.slice(0, 3); // En fazla 3 dinamik öneri
        }
        
        // Önerileri göster/gizle
        function toggleSuggestions() {
            const suggestionsPanel = document.getElementById('aiSuggestions');
            const toggleLink = document.getElementById('aiToggleSuggestions');
            
            if (!suggestionsPanel || !toggleLink) return;
            
            const isVisible = suggestionsPanel.style.display === 'block';
            
            if (isVisible) {
                suggestionsPanel.style.display = 'none';
                toggleLink.textContent = 'Önerileri göster';
            } else {
                suggestionsPanel.style.display = 'block';
                toggleLink.textContent = 'Önerileri gizle';
                displaySuggestions();
            }
        }

        // Doğal dil işleme özelliklerini uygulama
        function applyNLPFeatures(userMessage, aiResponse) {
            // Kullanıcı mesajındaki anahtar kelimeleri ve sorgu tipini analiz et
            const lowerUserMsg = userMessage.toLowerCase();
            
            // Bağlam algılama - soruda geçen bağlamı koru ve bir sonraki soruda kullan
            if (!aiAssistant.context) {
                // Yeni bağlam oluştur
                if (lowerUserMsg.includes('sipariş') || lowerUserMsg.includes('üretim') || lowerUserMsg.includes('#0424')) {
                    aiAssistant.context = 'order';
                } else if (lowerUserMsg.includes('malzeme') || lowerUserMsg.includes('stok') || lowerUserMsg.includes('tedarik')) {
                    aiAssistant.context = 'material';
                } else if (lowerUserMsg.includes('rapor') || lowerUserMsg.includes('analiz') || lowerUserMsg.includes('performans')) {
                    aiAssistant.context = 'report';
                }
            } else {
                // Eğer yeni bir bağlam söz konusuysa değiştir, değilse mevcut bağlamı koru
                if (lowerUserMsg.includes('sipariş') || lowerUserMsg.includes('üretim') || lowerUserMsg.includes('#0424')) {
                    aiAssistant.context = 'order';
                } else if (lowerUserMsg.includes('malzeme') || lowerUserMsg.includes('stok') || lowerUserMsg.includes('tedarik')) {
                    aiAssistant.context = 'material';
                } else if (lowerUserMsg.includes('rapor') || lowerUserMsg.includes('analiz') || lowerUserMsg.includes('performans')) {
                    aiAssistant.context = 'report';
                }
                
                // Bağlam bazlı bilgi ekleme
                if (aiAssistant.context === 'order' && !lowerUserMsg.includes('sipariş') && !lowerUserMsg.includes('#0424')) {
                    // Bağlamı koruyarak, bağlama özel bilgiler ekle
                    aiResponse += "\n\n*Not: Önceki sorularınız üretim siparişleriyle ilgiliydi. Başka bir sipariş hakkında bilgi almak isterseniz sipariş numarasını belirtebilirsiniz.*";
                } else if (aiAssistant.context === 'material' && !lowerUserMsg.includes('malzeme') && !lowerUserMsg.includes('stok')) {
                    aiResponse += "\n\n*Not: Önceki sorularınız malzeme yönetimiyle ilgiliydi. Belirli bir malzeme hakkında daha detaylı bilgi almak isterseniz malzeme kodunu belirtebilirsiniz.*";
                }
            }
            
            return aiResponse;
        }

        // AI modunu değiştir
        function changeAIMode(mode) {
            aiAssistant.currentMode = mode;
            
            // Aktif sınıfını güncelle
            document.querySelectorAll('[data-ai-mode]').forEach(element => {
                element.classList.remove('active');
                if (element.dataset.aiMode === mode) {
                    element.classList.add('active');
                }
            });
            
            // Mod göstergesini güncelle
            const indicator = document.getElementById('aiModeSwitcher');
            if (indicator) {
                const modeNames = {
                    'assistant': 'Asistan Modu',
                    'analyst': 'Analiz Modu',
                    'reporter': 'Rapor Modu',
                    'predictor': 'Tahmin Modu',
                    'expert': 'Uzman Modu'
                };
                
                indicator.innerHTML = `<i class="bi bi-gear"></i> ${modeNames[mode] || 'Mod'}`;
            }
            
            // Bağlam göstergesini güncelle
            updateContextIndicator(mode);
            
            // Mod değişikliği hakkında bir mesaj göster
            const modeChangeMessage = getModeSwitchMessage(mode);
            displayAIMessage(modeChangeMessage);
            
            // Önerileri güncelle
            displaySuggestions();
        }

        // Bağlam göstergesini güncelle
        function updateContextIndicator(mode) {
            const indicator = document.getElementById('aiContextIndicator');
            if (!indicator) return;
            
            // Mod simgesini güncelle
            const modeIcons = {
                'assistant': 'bi-chat-dots',
                'analyst': 'bi-bar-chart',
                'reporter': 'bi-file-text',
                'predictor': 'bi-graph-up-arrow',
                'expert': 'bi-mortarboard'
            };
            
            indicator.innerHTML = `<i class="bi ${modeIcons[mode] || 'bi-chat'}"></i>`;
            indicator.title = `${mode.charAt(0).toUpperCase() + mode.slice(1)} Modu`;
            
            // Mod tipine göre renk değiştir
            const modeColors = {
                'assistant': 'light',
                'analyst': 'info',
                'reporter': 'warning',
                'predictor': 'success',
                'expert': 'danger'
            };
            
            indicator.className = `input-group-text bg-${modeColors[mode] || 'light'}`;
        }

        // Konuşmayı temizle
        function clearConversation() {
            // Onay al
            if (!confirm('Bu konuşmayı temizlemek istediğinize emin misiniz?')) return;
            
            // Chat alanını temizle
            document.getElementById('chatMessages').innerHTML = '';
            
            // Yeni oturum başlat
            aiAssistant.currentSession = {
                id: `session-${Date.now()}`,
                startTime: new Date().toISOString(),
                messages: []
            };
            
            // Karşılama mesajını göster
            displayAIMessage(getWelcomeMessage(), false);
            
            // Önerileri güncelle
            displaySuggestions();
            
            showNetworkStatusNotification('Konuşma temizlendi', 'info');
        }
        
        // AI Rapor oluşturma fonksiyonu
        function generateAIReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const departmentsSelect = document.getElementById('reportDepartments');
            const departments = Array.from(departmentsSelect.selectedOptions).map(opt => opt.value);
            const focus = document.getElementById('reportFocus').value;
            const customCriteria = document.getElementById('customReportCriteria')?.value;
            const includeCharts = document.getElementById('includeCharts').checked;
            
            // Validasyon
            if (!reportType || !startDate || !endDate || departments.length === 0) {
                alert('Lütfen tüm gerekli alanları doldurun');
                return;
            }
            
            // Rapor verisini hazırla
            const reportData = prepareReportData(reportType, startDate, endDate, departments, focus, customCriteria);
            
            // Modal'ı kapat
            const reportModal = bootstrap.Modal.getInstance(document.getElementById('aiReportModal'));
            if (reportModal) reportModal.hide();
            
            // Rapor modal'ını oluştur
            showGeneratedReport(reportData, includeCharts);
        }
        
        // Oluşturulan raporu göster
        function showGeneratedReport(reportData, includeCharts) {
            // Modal HTML'ini oluştur
            const modalHTML = `
                <div class="modal fade" id="generatedReportModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="bi bi-file-earmark-text"></i> ${reportData.title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body" id="reportContainer">
                                ${generateReportHTML(reportData, includeCharts)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-primary" onclick="window.print()">
                                    <i class="bi bi-printer"></i> Yazdır
                                </button>
                                <button type="button" class="btn btn-outline-success" onclick="exportReportToPDF()">
                                    <i class="bi bi-file-earmark-pdf"></i> PDF
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // HTML'i sayfaya ekle
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('generatedReportModal'));
            modal.show();
            
            // Grafikler varsa oluştur
            if (includeCharts) {
                setTimeout(() => {
                    renderReportCharts(reportData);
                }, 500);
            }
            
            // Modal kapatıldığında temizlik yap
            document.getElementById('generatedReportModal').addEventListener('hidden.bs.modal', function() {
                document.getElementById('generatedReportModal').remove();
            });
        }
        
        // Tahmin modalını göster
        function showPredictionModal() {
            const modal = new bootstrap.Modal(document.getElementById('aiPredictionModal'));
            modal.show();
            
            // Grafiği oluştur
            setTimeout(() => {
                renderDeliveryPredictionChart();
            }, 500);
        }
        
        // Rapor modalını göster
        function showReportModal() {
            // Bugünkü tarihi varsayılan olarak ayarla
            const today = new Date();
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(today.getDate() - 7);
            
            document.getElementById('reportStartDate').value = oneWeekAgo.toISOString().split('T')[0];
            document.getElementById('reportEndDate').value = today.toISOString().split('T')[0];
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('aiReportModal'));
            modal.show();
        }
        
        // Veri ekleme seçeneklerini göster
        function showDataAttachmentOptions() {
            // Gerçek uygulamada bu fonksiyon dosya eklemek için bir arayüz gösterecek
            alert('Bu özellik demo versiyonunda henüz aktif değil');
        }

        // LocalStorage'dan konversationları yükle
        function loadConversationsFromStorage() {
            const savedConversations = localStorage.getItem('metsAiConversations');
            if (savedConversations) {
                aiAssistant.conversationHistory = JSON.parse(savedConversations);
                
                // Son oturumu yükle (varsa)
                if (aiAssistant.conversationHistory.length > 0) {
                    const lastSession = aiAssistant.conversationHistory[aiAssistant.conversationHistory.length - 1];
                    
                    // Son oturum 24 saatten eski değilse, devam et
                    const lastSessionTime = new Date(lastSession.startTime);
                    const now = new Date();
                    const hoursDiff = (now - lastSessionTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        aiAssistant.currentSession = lastSession;
                    }
                }
            }
        }
    </script>



    <!-- Not ve Uyarı Sistemi JS -->
    <script>
        // Uyarı Sistemi Veritabanı (LocalStorage'da saklanacak)
        let alertsDB = {
            alerts: [
                {
                    id: "ALT-001",
                    orderId: "#0424-1251",
                    title: "Teslim Tarihi Gecikmesi",
                    description: "RM 36 CB hücresinin mekanik montajı gecikiyor. Akım trafosu montajında uyumsuzluk tespit edildi.",
                    priority: "red",
                    department: "production-mechanical",
                    departmentName: "Mekanik Üretim",
                    createdBy: "Ahmet Yılmaz",
                    createdAt: new Date(Date.now() - 3600000).toISOString(), // 1 saat önce
                    status: "pending",
                    deadline: new Date(Date.now() + 6600000).toISOString(), // 3 saat - geçen 1 saat = 2 saat 50 dk
                    responses: []
                },
                {
                    id: "ALT-002",
                    orderId: "#0424-1245",
                    title: "Malzeme Eksikliği",
                    description: "Sipariş için gerekli akım trafosu stokta yok. İvedi sipariş gerekiyor.",
                    priority: "yellow",
                    department: "purchasing",
                    departmentName: "Satın Alma",
                    createdBy: "Mehmet Demir",
                    createdAt: new Date(Date.now() - 10800000).toISOString(), // 3 saat önce
                    status: "in-progress",
                    deadline: new Date(Date.now() - 100000).toISOString(), // Süresi geçmiş
                    responses: [
                        {
                            id: "RSP-001",
                            alertId: "ALT-002",
                            responseType: "in-progress", 
                            comment: "Sipariş açıldı, tedarikçi ile görüşüldü. 2 gün içinde teslim edilecek.",
                            respondedBy: "Ayşe Kaya",
                            respondedAt: new Date(Date.now() - 9000000).toISOString(),
                            department: "purchasing"
                        }
                    ]
                },
                {
                    id: "ALT-003",
                    orderId: "#0424-1239",
                    title: "Sorun Çözüldü",
                    description: "Kablaj problemi tespit edildi ve çözüldü.",
                    priority: "yellow",
                    department: "production-wiring",
                    departmentName: "Kablaj",
                    createdBy: "Fatma Şahin",
                    createdAt: new Date(Date.now() - 18000000).toISOString(), // 5 saat önce
                    status: "resolved",
                    deadline: new Date(Date.now() - 7200000).toISOString(),
                    responses: [
                        {
                            id: "RSP-002",
                            alertId: "ALT-003",
                            responseType: "solved",
                            comment: "Problem tespit edildi, kablo değiştirilerek sorun çözüldü.",
                            respondedBy: "Hasan Yılmaz",
                            respondedAt: new Date(Date.now() - 16200000).toISOString(),
                            department: "production-wiring"
                        }
                    ]
                }
            ]
        };

        // LocalStorage'dan verileri yükle
        function loadAlertsFromStorage() {
            const savedAlerts = localStorage.getItem('mehmetet_alerts');
            if (savedAlerts) {
                alertsDB = JSON.parse(savedAlerts);
            }
        }

        // Verileri LocalStorage'a kaydet
        function saveAlertsToStorage() {
            localStorage.setItem('mehmetet_alerts', JSON.stringify(alertsDB));
        }

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            // LocalStorage'dan uyarıları yükle
            loadAlertsFromStorage();
            
            // Dashboard uyarılarını göster
            updateDashboardAlerts();
            
            // Bekleyen uyarı sayısını güncelle
            updatePendingAlertsCount();
            
            // Yanıt tipi değiştiğinde ilgili alanları göster/gizle
            document.getElementById('responseType').addEventListener('change', function() {
                const selectedType = this.value;
                
                // Tümünü gizle
                document.getElementById('delayTimeContainer').style.display = 'none';
                document.getElementById('reassignDepartmentContainer').style.display = 'none';
                
                // Seçime göre göster
                if (selectedType === 'delayed') {
                    document.getElementById('delayTimeContainer').style.display = 'block';
                }
                
                if (selectedType === 'reassign') {
                    document.getElementById('reassignDepartmentContainer').style.display = 'block';
                }
            });
            
            // Uyarı yanıtı gönderme butonuna tıklandığında
            document.getElementById('submitAlertResponse').addEventListener('click', function() {
                submitAlertResponse();
            });
            
            // Filtrele butonuna tıklandığında
            document.getElementById('applyAlertFilters').addEventListener('click', function() {
                filterAlerts();
            });
            
            // Yeni uyarı kaydetme butonuna tıklandığında
            document.getElementById('saveAlertBtn').addEventListener('click', function() {
                saveNewAlert();
            });
            
            // 1 dakikada bir süreleri güncelle
            setInterval(updateCountdowns, 60000);
            
            // İlk kez sayfa açıldığında süreleri güncelle
            updateCountdowns();
            
            // Birim bazlı analiz grafiğini oluştur
            renderDepartmentAnalysisChart();
        });

        // Uyarı detaylarını göster
        function viewAlertDetail(alertId, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const alert = alertsDB.alerts.find(a => a.id === alertId);
            if (!alert) return;
            
            const alertDetailContent = document.getElementById('alertDetailContent');
            const alertResponsesContainer = document.getElementById('alertResponsesContainer');
            
            // Uyarı detaylarını göster
            alertDetailContent.className = `alert ${alert.priority === 'red' ? 'alert-danger' : 'alert-warning'}`;
            alertDetailContent.innerHTML = `
                <h5>${alert.title} <span class="badge ${alert.priority === 'red' ? 'bg-danger' : 'bg-warning'}">${alert.priority === 'red' ? 'Kritik' : 'Önemli'}</span></h5>
                <p>${alert.description}</p>
                <div class="d-flex justify-content-between">
                    <small>Sipariş: ${alert.orderId}</small>
                    <small>Oluşturan: ${alert.createdBy}</small>
                    <small>Tarih: ${formatDate(alert.createdAt)}</small>
                </div>
                <div class="mt-2">
                    <span class="badge bg-secondary">${alert.departmentName}</span>
                    <span class="badge ${getStatusBadgeClass(alert.status)}">${getStatusText(alert.status)}</span>
                </div>
            `;
            
            // Yanıtları göster
            alertResponsesContainer.innerHTML = '';
            if (alert.responses && alert.responses.length > 0) {
                alert.responses.forEach(response => {
                    alertResponsesContainer.innerHTML += createResponseHtml(response);
                });
            } else {
                alertResponsesContainer.innerHTML = '<div class="alert alert-light">Henüz yanıt yok.</div>';
            }
            
            // Yanıt formunu göster veya gizle
            const responseForm = document.getElementById('alertResponseForm');
            if (alert.status === 'resolved') {
                responseForm.style.display = 'none';
            } else {
                responseForm.style.display = 'block';
                // Form submit işlevini ayarla
                document.getElementById('submitAlertResponse').onclick = function() {
                    submitAlertResponse(alertId);
                };
            }
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('alertDetailModal'));
            modal.show();
        }

        // Uyarı yanıtlarını göster
        function viewAlertResponses(alertId, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            viewAlertDetail(alertId);
        }

        // Uyarıya yanıt ver modalını aç
        function respondToAlert(alertId, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            viewAlertDetail(alertId);
            
            // Form alanına odaklan
            setTimeout(() => {
                document.getElementById('responseComment').focus();
            }, 500);
        }

        // Tüm uyarılar modalını aç
        function openAllAlertsModal() {
            const allAlertsTable = document.getElementById('allAlertsTable').querySelector('tbody');
            allAlertsTable.innerHTML = '';
            
            // Tüm uyarıları ekle
            alertsDB.alerts.forEach(alert => {
                const row = document.createElement('tr');
                
                // Öncelik sınıfı ekle
                if (alert.priority === 'red') {
                    row.classList.add('table-danger');
                } else if (alert.priority === 'yellow') {
                    row.classList.add('table-warning');
                }
                
                row.innerHTML = `
                    <td>${alert.id}</td>
                    <td>${alert.orderId}</td>
                    <td>
                        <span class="badge ${alert.priority === 'red' ? 'bg-danger' : 'bg-warning'}">
                            ${alert.priority === 'red' ? 'Kritik' : 'Önemli'}
                        </span>
                    </td>
                    <td>${alert.title}</td>
                    <td>${alert.departmentName}</td>
                    <td>${formatDateShort(alert.createdAt)}</td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(alert.status)}">
                            ${getStatusText(alert.status)}
                        </span>
                    </td>
                    <td>${getRemainingTimeText(alert)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewAlertDetail('${alert.id}')">
                            <i class="bi bi-eye"></i>
                        </button>
                        ${alert.status !== 'resolved' ? 
                            `<button class="btn btn-sm btn-outline-success ms-1" onclick="respondToAlert('${alert.id}')">
                                <i class="bi bi-reply"></i>
                            </button>` : ''}
                    </td>
                `;
                
                allAlertsTable.appendChild(row);
            });
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('allAlertsModal'));
            modal.show();
        }

        // Bekleyen uyarıları göster
        function showPendingAlerts() {
            // Tüm uyarılar modalını aç
            openAllAlertsModal();
            
            // Bekleyen uyarıları filtrele
            document.getElementById('alertStatusFilter').value = 'pending';
            filterAlerts();
        }

        // Uyarıları filtrele
        function filterAlerts() {
            const typeFilter = document.getElementById('alertTypeFilter').value;
            const statusFilter = document.getElementById('alertStatusFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            const rows = document.getElementById('allAlertsTable').querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const alertId = row.cells[0].textContent;
                const alert = alertsDB.alerts.find(a => a.id === alertId);
                
                if (!alert) return;
                
                let showRow = true;
                
                // Tip filtreleme
                if (typeFilter !== 'all' && alert.priority !== typeFilter) {
                    showRow = false;
                }
                
                // Durum filtreleme
                if (statusFilter !== 'all' && alert.status !== statusFilter) {
                    showRow = false;
                }
                
                // Departman filtreleme
                if (departmentFilter !== 'all' && alert.department !== departmentFilter) {
                    showRow = false;
                }
                
                // Satırı göster veya gizle
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Uyarı yanıtı gönder
        function submitAlertResponse(alertId) {
            const currentAlert = alertsDB.alerts.find(a => a.id === alertId);
            if (!currentAlert) return;
            
            const responseType = document.getElementById('responseType').value;
            const comment = document.getElementById('responseComment').value;
            
            if (!comment) {
                alert('Lütfen bir açıklama yazın.');
                return;
            }
            
            // Ek alanları kontrol et
            let additionalData = {};
            
            if (responseType === 'delayed') {
                additionalData.delayTime = document.getElementById('delayTime').value;
            }
            
            if (responseType === 'reassign') {
                additionalData.reassignDepartment = document.getElementById('reassignDepartment').value;
                additionalData.reassignDepartmentName = document.getElementById('reassignDepartment').options[
                    document.getElementById('reassignDepartment').selectedIndex
                ].text;
            }
            
            // Yeni yanıt oluştur
            const newResponse = {
                id: `RSP-${Date.now()}`,
                alertId: currentAlert.id,
                responseType: responseType,
                comment: comment,
                respondedBy: "Aktif Kullanıcı", // Gerçek uygulamada oturum açan kullanıcı
                respondedAt: new Date().toISOString(),
                department: "current-department", // Gerçek uygulamada kullanıcının departmanı
                additionalData: additionalData
            };
            
            // Uyarının durumunu güncelle
            let newStatus = currentAlert.status;
            
            switch (responseType) {
                case 'solved':
                    newStatus = 'resolved';
                    break;
                case 'in-progress':
                case 'delayed':
                case 'needs-info':
                    newStatus = 'in-progress';
                    break;
                case 'reassign':
                    // Departman değişimi
                    currentAlert.department = additionalData.reassignDepartment;
                    currentAlert.departmentName = additionalData.reassignDepartmentName;
                    // Yeni departman için yeni süre başlat
                    currentAlert.deadline = new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(); // 3 saat
                    newStatus = 'pending';
                    break;
                case 'cant-solve':
                    newStatus = 'escalated';
                    break;
            }
            
            currentAlert.status = newStatus;
            
            // Yanıtı ekle
            if (!currentAlert.responses) currentAlert.responses = [];
            currentAlert.responses.push(newResponse);
            
            // Verileri kaydet
            saveAlertsToStorage();
            
            // UI güncelle
            updateDashboardAlerts();
            updatePendingAlertsCount();
            
            // Yanıt formunu temizle
            document.getElementById('responseComment').value = '';
            
            // Modal'ı kapat ve detay modalını yenile
            viewAlertDetail(alertId);
            
            // Bildirim göster
            showNetworkStatusNotification('Yanıtınız kaydedildi', 'success');
        }

        // Yeni uyarı oluştur
        function createNewAlert(orderId) {
            // Form alanlarını temizle
            document.getElementById('alertTitle').value = '';
            document.getElementById('alertDescription').value = '';
            document.getElementById('alertPriority').value = 'yellow';
            document.getElementById('alertDepartment').value = '';
            
            // Sipariş ID'sini ayarla
            document.getElementById('alertOrderId').value = orderId;
            
            // Modal'ı göster
            const modal = new bootstrap.Modal(document.getElementById('createAlertModal'));
            modal.show();
        }

        // Yeni uyarıyı kaydet
        function saveNewAlert() {
            const title = document.getElementById('alertTitle').value;
            const description = document.getElementById('alertDescription').value;
            const priority = document.getElementById('alertPriority').value;
            const department = document.getElementById('alertDepartment').value;
            const orderId = document.getElementById('alertOrderId').value;
            
            if (!title || !description || !department || !orderId) {
                alert('Lütfen tüm alanları doldurun.');
                return;
            }
            
            // Departman adını al
            const departmentName = document.getElementById('alertDepartment').options[
                document.getElementById('alertDepartment').selectedIndex
            ].text;
            
            // Yeni uyarı oluştur
            const newAlert = {
                id: `ALT-${Date.now()}`,
                orderId: orderId,
                title: title,
                description: description,
                priority: priority,
                department: department,
                departmentName: departmentName,
                createdBy: "Aktif Kullanıcı", // Gerçek uygulamada oturum açan kullanıcı
                createdAt: new Date().toISOString(),
                status: "pending",
                deadline: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(), // 3 saat
                responses: []
            };
            
            // Uyarıyı ekle
            alertsDB.alerts.push(newAlert);
            
            // Verileri kaydet
            saveAlertsToStorage();
            
            // UI güncelle
            updateDashboardAlerts();
            updatePendingAlertsCount();
            
            // İlgili siparişin kartına uyarı işareti ekle
            addAlertBadgeToOrder(orderId, priority);
            
            // Modal'ı kapat
            const modal = bootstrap.Modal.getInstance(document.getElementById('createAlertModal'));
            modal.hide();
            
            // Bildirim göster
            showNetworkStatusNotification('Yeni uyarı oluşturuldu', 'success');
        }

        // Siparişe uyarı rozeti ekle
        function addAlertBadgeToOrder(orderId, priority) {
            const orderCards = document.querySelectorAll(`[data-order-id="${orderId}"]`);
            orderCards.forEach(card => {
                // Mevcut rozeti kontrol et
                let badge = card.querySelector('.notification-pill');
                if (!badge) {
                    // Yoksa yeni rozet ekle
                    badge = document.createElement('span');
                    badge.classList.add('notification-pill');
                    card.appendChild(badge);
                }
                
                // Rozeti güncelle
                badge.className = `notification-pill notification-${priority}`;
                
                // Bu sipariş için toplam uyarı sayısını hesapla
                const orderAlerts = alertsDB.alerts.filter(alert => alert.orderId === orderId);
                
                // Sayıyı rozete ekle
                if (orderAlerts.length > 1) {
                    badge.innerHTML = `<span class="notification-counter">${orderAlerts.length}</span>`;
                }
            });
        }

        // Bekleyen uyarı sayısını güncelle
        function updatePendingAlertsCount() {
            const pendingAlerts = alertsDB.alerts.filter(alert => 
                alert.status === 'pending' || (alert.status === 'in-progress' && new Date(alert.deadline) < new Date())
            );
            
            const countElement = document.getElementById('pendingAlertsCount');
            if (countElement) {
                countElement.textContent = pendingAlerts.length;
                
                // Eğer bekleyen uyarı varsa animasyon ekle
                if (pendingAlerts.length > 0) {
                    document.querySelectorAll('.notification-badge').forEach(badge => {
                        badge.classList.add('has-alerts');
                    });
                } else {
                    document.querySelectorAll('.notification-badge').forEach(badge => {
                        badge.classList.remove('has-alerts');
                    });
                }
            }
        }

        // Dashboard uyarılarını güncelle
        function updateDashboardAlerts() {
            const container = document.getElementById('dashboardAlerts');
            if (!container) return;
            
            // En son 3 uyarıyı al
            const recentAlerts = [...alertsDB.alerts]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 3);
            
            container.innerHTML = '';
            
            recentAlerts.forEach(alert => {
                let statusHtml;
                
                if (alert.status === 'pending') {
                    const remainingTime = getRemainingTimeText(alert);
                    statusHtml = `
                        <small class="text-muted">Yanıt bekleniyor - <span class="timer-countdown">${remainingTime}</span> kaldı</small>
                        <button class="btn btn-sm btn-danger" onclick="respondToAlert('${alert.id}', event)">Yanıtla</button>
                    `;
                } else if (alert.status === 'in-progress') {
                    // Son yanıtı göster
                    const latestResponse = alert.responses[alert.responses.length - 1];
                    statusHtml = `
                        <small class="text-muted">Yanıtlandı - ${getResponseSummary(latestResponse)}</small>
                        <button class="btn btn-sm btn-secondary" onclick="viewAlertResponses('${alert.id}', event)">Yanıtlar</button>
                    `;
                } else if (alert.status === 'resolved') {
                    statusHtml = `
                        <small class="text-muted">Çözüldü - Kapandı</small>
                        <button class="btn btn-sm btn-success" onclick="viewAlertResponses('${alert.id}', event)">Detay</button>
                    `;
                }
                
                const alertHtml = `
                    <a href="#" class="list-group-item list-group-item-action border-${getStatusColor(alert)} border-start-0 border-end-0 border-top-0 border-3" onclick="viewAlertDetail('${alert.id}', event)">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">
                                <span class="notification-pill notification-${alert.priority}">${alert.priority === 'red' ? 'Kritik' : 'Önemli'}</span>
                                ${alert.title}
                                <span class="badge bg-secondary department-badge">${alert.departmentName}</span>
                            </h6>
                            <small class="text-${getStatusColor(alert)}">${formatTimeAgo(alert.createdAt)}</small>
                        </div>
                        <p class="mb-1">Sipariş No: ${alert.orderId} - ${alert.description}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            ${statusHtml}
                        </div>
                    </a>
                `;
                
                container.innerHTML += alertHtml;
            });
        }

        // Tüm süreleri güncelle
        function updateCountdowns() {
            const countdownElements = document.querySelectorAll('.timer-countdown');
            
            countdownElements.forEach(element => {
                // İlgili uyarıyı bul
                const alertItem = element.closest('.list-group-item');
                if (!alertItem) return;
                
                const alertId = alertItem.getAttribute('onclick').split("'")[1];
                const alert = alertsDB.alerts.find(a => a.id === alertId);
                
                if (!alert) return;
                
                // Süreyi güncelle
                element.textContent = getRemainingTimeText(alert);
                
                // Süre geçtiyse uyarı ekle
                if (new Date(alert.deadline) < new Date()) {
                    element.style.color = '#d32f2f';
                    element.innerHTML = `<i class="bi bi-alarm"></i> ${element.textContent}`;
                }
            });
        }

        // Yanıt HTML'i oluştur
        function createResponseHtml(response) {
            const responseTypeClass = getResponseTypeClass(response.responseType);
            const responseTypeText = getResponseTypeText(response.responseType);
            
            let additionalInfoHtml = '';
            
            if (response.additionalData) {
                if (response.additionalData.delayTime) {
                    additionalInfoHtml = `<div class="alert alert-warning py-1 px-2 mt-1 mb-0">
                        <small><i class="bi bi-hourglass-split"></i> ${response.additionalData.delayTime} gün ertelendi</small>
                    </div>`;
                }
                
                if (response.additionalData.reassignDepartment) {
                    additionalInfoHtml = `<div class="alert alert-info py-1 px-2 mt-1 mb-0">
                        <small><i class="bi bi-arrow-right-circle"></i> ${response.additionalData.reassignDepartmentName} birimine aktarıldı</small>
                    </div>`;
                }
            }
            
            return `
                <div class="alert-note ${responseTypeClass} mb-3">
                    <div class="alert-note-header d-flex justify-content-between">
                        <span class="badge ${getResponseTypeBadgeClass(response.responseType)}">${responseTypeText}</span>
                        <small>${formatDateShort(response.respondedAt)}</small>
                    </div>
                    <p class="mt-2 mb-1">${response.comment}</p>
                    ${additionalInfoHtml}
                    <div class="meta">
                        <small>Yanıtlayan: ${response.respondedBy}</small>
                    </div>
                </div>
            `;
        }

        // Yardımcı Fonksiyonlar
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('tr-TR');
        }
        
        function formatDateShort(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('tr-TR', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000); // saniye cinsinden fark
            
            if (diff < 60) return 'Az önce';
            if (diff < 3600) return `${Math.floor(diff / 60)} dakika önce`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} saat önce`;
            return `${Math.floor(diff / 86400)} gün önce`;
        }
        
        function getRemainingTimeText(alert) {
            if (!alert.deadline) return '';
            
            const deadline = new Date(alert.deadline);
            const now = new Date();
            
            // Eğer süre geçtiyse
            if (deadline < now) {
                const diff = Math.floor((now - deadline) / 1000); // saniye cinsinden fark
                if (diff < 3600) return `${Math.floor(diff / 60)} dk gecikmiş`;
                if (diff < 86400) return `${Math.floor(diff / 3600)} saat gecikmiş`;
                return `${Math.floor(diff / 86400)} gün gecikmiş`;
            }
            
            // Kalan süre
            const diff = Math.floor((deadline - now) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            
            return `${hours}:${minutes.toString().padStart(2, '0')}`;
        }
        
        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'Yanıt Bekliyor';
                case 'in-progress': return 'Çözülüyor';
                case 'resolved': return 'Çözüldü';
                case 'escalated': return 'Yönetim Kararı';
                default: return 'Bilinmeyen';
            }
        }
        
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'pending': return 'bg-danger';
                case 'in-progress': return 'bg-warning';
                case 'resolved': return 'bg-success';
                case 'escalated': return 'bg-info';
                default: return 'bg-secondary';
            }
        }
        
        function getStatusColor(alert) {
            switch (alert.status) {
                case 'pending': return 'danger';
                case 'in-progress': return 'warning';
                case 'resolved': return 'success';
                case 'escalated': return 'info';
                default: return 'secondary';
            }
        }
        
        function getResponseTypeClass(type) {
            switch (type) {
                case 'solved': return 'alert-note-success';
                case 'in-progress': 
                case 'needs-info': return 'alert-note-yellow';
                case 'delayed':
                case 'reassign':  
                case 'cant-solve': return 'alert-note-red';
                default: return 'alert-note-yellow';
            }
        }
        
        function getResponseTypeBadgeClass(type) {
            switch (type) {
                case 'solved': return 'bg-success';
                case 'in-progress': return 'bg-primary';
                case 'needs-info': return 'bg-info';
                case 'delayed': return 'bg-warning';
                case 'reassign': return 'bg-secondary';
                case 'cant-solve': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        function getResponseTypeText(type) {
            switch (type) {
                case 'solved': return 'Çözüldü';
                case 'in-progress': return 'Üzerinde Çalışılıyor';
                case 'needs-info': return 'Bilgi Gerekli';
                case 'delayed': return 'Ertelendi';
                case 'reassign': return 'Başka Birime Aktarıldı';
                case 'cant-solve': return 'Çözülemiyor';
                default: return type;
            }
        }
        
        function getResponseSummary(response) {
            if (!response) return '';
            
            switch (response.responseType) {
                case 'solved': return 'Çözüldü';
                case 'in-progress': return 'Üzerinde çalışılıyor';
                case 'needs-info': return 'Daha fazla bilgi gerekli';
                case 'delayed': 
                    return response.additionalData?.delayTime ? 
                        `${response.additionalData.delayTime} gün içinde çözülecek` : 
                        'Ertelendi';
                case 'reassign': 
                    return response.additionalData?.reassignDepartmentName ?
                        `${response.additionalData.reassignDepartmentName} birimine aktarıldı` :
                        'Başka birime aktarıldı';
                case 'cant-solve': return 'Yönetim kararı gerekiyor';
                default: return response.comment.substring(0, 30) + '...';
            }
        }

        // Birim bazlı analiz grafiği
        function renderDepartmentAnalysisChart() {
            const ctx = document.getElementById('alertResolutionChart');
            if (!ctx) return;
            
            // Analiz verilerini hesapla
            const departments = ['Mekanik Üretim', 'Satın Alma', 'Kablaj', 'Elektrik Tasarım', 'Mekanik Tasarım'];
            const responseTime = [4.2, 6.8, 2.1, 3.5, 5.2]; // saat cinsinden
            const resolutionRate = [80, 83, 100, 92, 75]; // yüzde cinsinden
            const recurringIssues = [3, 1, 0, 2, 4]; // adet cinsinden
            
            // Grafiği oluştur
            if (typeof Chart !== 'undefined') {
                try {
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: departments,
                            datasets: [
                                {
                                    label: 'Ortalama Çözüm Süresi (saat)',
                                    data: responseTime,
                                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                                    borderColor: 'rgb(54, 162, 235)',
                                    borderWidth: 1,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'Çözüm Oranı (%)',
                                    data: resolutionRate,
                                    backgroundColor: 'rgba(75, 192, 192, 0.7)',
                                    borderColor: 'rgb(75, 192, 192)',
                                    borderWidth: 1,
                                    yAxisID: 'y1'
                                },
                                {
                                    label: 'Tekrarlayan Sorunlar (adet)',
                                    data: recurringIssues,
                                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 1,
                                    yAxisID: 'y'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'Saat / Adet'
                                    }
                                },
                                y1: {
                                    beginAtZero: true,
                                    max: 100,
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: 'Yüzde (%)'
                                    },
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Birim Bazlı Uyarı Analizi'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.dataset.yAxisID === 'y1') {
                                                label += context.raw + '%';
                                            } else {
                                                label += context.raw;
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Uyarı analiz grafiği oluşturulurken hata:', error);
                }
            }
        }
    </script>
</body>
</html>
